!function(){var t,G;t=function(){},"function"==typeof define&&define.amd&&define(t),(G=jQuery).fn.datagrid=function(){var v,b,y,k,x=this,n=this.attr("id"),i=G("#"+n+"-menu"),e=x.children(".datagrid-main"),t=e.children(".datagrid"),l=t.children(".datagrid-body-container"),W=t.children(".datagrid-head"),B=l.children(".datagrid-body"),C=B.children("thead"),j=t.children(".paginator"),M=G(window),S="#"+n+"-edit",s=[],z=[],H=!1,N=null,a=[],d=null,o=!1,r=0,c=0,h=0;function u(){var t,i=B.children("thead");z=[],B.find("colgroup col").each(function(t,i){s.push(i.width),"datagrid-customize"!==i.className&&z.push(i.className)}),t=i.clone().show(),W.children("thead").remove().end().append(t).show(),i.hide(),(i=W.find("th")).disableSelection(),i.not(".edit-columns").draggable({appendTo:"body",axis:"x",containment:t,cursor:"move",drag:X,helper:function(){var t=G(this);return G("<div>").addClass("datagrid-header-drag datagrid-header").width(t.width()).height(t.height()).css("top",t.offset().top).css("line-height",t.height()+"px").html(t.html())},start:F,stop:Q}),W.find(".datagrid-header-checkbox").change(function(){var t=G(this),i=t.data("checkbox-name");B.find('tbody input[data-checkbox-name="'+i+'"]').prop("checked",t.prop("checked")).change()}),v=G(S)}function T(){for(var t,i,e=C[0].rows[0].cells,n=W.find("colgroup col"),a=B.find("colgroup col"),d=0<n.filter(".datagrid-customize").length,o=e.length,d=o-(d?2:1),r=[],c=[],h=0;h<o;h++)a[h].width=s[h];for(C.show(),t=l.outerWidth(),W.width(t),t=t-B.width(),h=0;h<o;h++)i=G(e[h]).outerWidth(),r.push(i),c.push(i);for(C.hide(),c[d]=r[d]+t,h=0;h<o;h++)a[h].width=r[h],n[h].width=c[h]}function f(){var t=M.width();if(t!==k){if(k=t,q(),(t="block"===B.css("display"))!==N){if(t){var i,e,n,a,d,o,r,c,h,l=B[0],s=l.tBodies[0].rows,u=s.length,f=z.length,p={},g=!1,m=[],w=G("<tbody>");if(C.find("th").each(function(t,i){var e=G(i);if(e.hasClass("has-label")){p[t]=true;m.push(e.text().trim());g=true}else m.push(null)}),g){for(c=0;c<u;c++){for(a=G(),r=s[c],i=G(r).clone(),w.append(i),n=i,h=0;h<f;h++)o=!1,d=G(i[0].cells[h]),p[h]?(e=d.clone().attr("colspan",f),o=!0,n.addClass("datagrid-row-continues"),n=G('<tr class="mobile-only-row">').addClass(r.className).append(G("<th>").text(m[h])).append(e).appendTo(w)):d.html().trim()?d.attr("colspan",""):o=!0,o&&(a=a.add(d),i.append("<td>"));f-a.length==0?i.remove():(a.remove(),i.prepend("<th>"))}y=W.find("thead").clone(),W.find("thead th").not(".edit-columns").text(""),b=G(l.tBodies[0]),G(l.tBodies[0]).replaceWith(w),x.attr("data-datagrid-display-mode","mobile").trigger("datagridDisplayModeChanged",{mode:"mobile"})}}else b&&(G(B[0].tBodies[0]).replaceWith(b),W.find("thead").replaceWith(y)),x.attr("data-datagrid-display-mode","desktop").trigger("datagridDisplayModeChanged",{mode:"desktop"});N=t}v=G(S),T(),H&&D()}}function q(){var t;e.css("max-width",""),0<(t=Math.ceil(e.width()))&&e.css("max-width",t)}function p(t,i){var e=window.location.search||"?",e=window.location.pathname+e+"&gridonly=1&datagrid-id="+n;t&&(e+="&"+t),G.get(e,function(t){i?(x.replaceWith(t),x=G("#"+n).datagrid()):u(),x.trigger("reloaded")})}function g(){i.animate({right:-i.outerWidth()},{complete:function(){i.hide(),H=!1}})}function D(){i.css({right:-i.outerWidth(),top:v.position().top+v.innerHeight()}).show().animate({right:0},{complete:function(){H=!0}})}function m(t,i){p("columns="+t,i)}function w(e){var n="";return G(z).each(function(t){var i=z[t];i===e?e=null:(n+=i,t<z.length-1&&(n+=","))}),e&&(n+=","+e),n}function F(t,i){d=this,o=!1,r=i.helper.width(),h=c=0,E(),G(d).css("visibility","hidden")}function Q(){G(this).css("visibility","visible"),a=[],o&&m(w())}function X(t,i){var t=t.originalEvent.pageX,e=-1,n=-1;t!==h&&(e=t<h?(n=c-1,i.offset.left):(n=c+1,i.offset.left+i.helper.width()),0<=n&&n<a.length&&(t<h&&e<=a[n]?P(c,n):h<t&&e>=a[n]&&P(n,c)),h=t)}function E(){a=[],W.find("th").not(".edit-columns").each(function(t,i){var e=G(i),n=e.offset(),i=i===d?(c=t,r):e.width();a.push(Math.round(n.left+i/2))})}function P(t,i){var e=z[t];z[t]=z[i],z[i]=e,A(B[0],i,t),A(W[0],i,t),e=s[t],s[t]=s[i],s[i]=e,o=!0,E()}function A(t,i,e){var n,a,d,o,r,c=G(t).find("colgroup col");for(c.eq(e).insertBefore(c.eq(i)),r=0,o=t.rows.length;r<o;r++)d=(a=t.rows[r]).cells[e],n=a.cells[i],a.insertBefore(d,n),a=d.colSpan,d.colSpan=n.colSpan,n.colSpan=a}return this.reload=function(){p(null,!0)},this.resizeToFit=function(){var t;q(),t=Math.ceil(x.innerHeight()-l.position().top-e.position().top-e.getExtents("b","tb")-(j.outerHeight()||0)),l.height(t),i.outerHeight(t),T(),H&&D()},x.data("datagrid",this).on("click",S,function(t){t.stopPropagation(),i.is(":animated")||(i.is(":visible")?g:D)()}),u(),i.find("tr").each(function(t,i){var e=i.className;G(i).find(".datagrid-menu-checkbox, .datagrid-menu-label a").click(function(){return m(w(e),!0),!1})}),l.find("tr").on("click",function(t){var t=G(t.target);t.is("input")||0!==t.parents(".has-link").length||(t=G(this).data("url"))&&(window.location=t)}),G(document).on("click",g).on("click",".datagrid-body input",function(t){t.stopPropagation()}),M.resize(f),f(),x},G(document).ready(function(){G("div.datagrid-wrapper").datagrid()})}.call(this);
