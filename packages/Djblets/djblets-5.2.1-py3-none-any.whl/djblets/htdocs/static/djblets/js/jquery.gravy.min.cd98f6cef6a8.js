!function(){var b,r,i,e,n,s,t,o,a;b=jQuery,window.Djblets||(window.Djblets={}),void 0===b.support.touch&&(b.support.touch="ontouchstart"in window||navigator.msMaxTouchPoints),b.fn.extend({setVisible:function(t){return console.warn("$.setVisible is deprecated and will be removed in Djblets 6.0. Use $.toggle instead."),b(this).each(function(){t?b(this).show():b(this).hide()})},move:function(t,e,i){return b(this).each(function(){b(this).css({left:t,top:e}),i&&b(this).css("position",i)})},scrollIntoView:function(){var o=b(document),a=b(window);return b(this).each(function(){var t=b(this),e=t.offset(),i=o.scrollLeft(),n=o.scrollTop(),s=i+a.width()-(e.left+t.outerWidth(!0)),e=n+a.height()-(e.top+t.outerHeight(!0));s<0&&a.scrollLeft(i-s),e<0&&a.scrollTop(n-e)})}}),b.fn.getExtents=function(o,a){var r=0;return this.each(function(){for(var t,e,i,n=b(this),s=0;s<o.length;s++)for(t=o.charAt(s),e=0;e<a.length;e++)"b"===t?t="border":"m"===t?t="margin":"p"===t&&(t="padding"),"l"===(i=a.charAt(e))||"left"===i?i="Left":"r"===i||"right"===i?i="Right":"t"===i||"top"===i?i="Top":"b"!==i&&"bottom"!==i||(i="Bottom"),i=t+i,"border"===t&&(i+="Width"),i=(-1===(i=n.css(i)).indexOf(".")?parseInt:parseFloat)(i,10),isNaN(i)||(r+=i)}),r},b.fn.positionToSide=function(t,h){var d=t.offset(),u=t.width(),c=t.height(),t=b(document),e=b(window),p=t.scrollLeft(),f=t.scrollTop(),g=e.width(),m=e.height();return h=b.extend({fitOnScreen:!1,side:"b",xDistance:h.distance||0,xOffset:0,yDistance:h.distance||0,yOffset:0},h),b(this).each(function(){for(var t,e,i,n=b(this),s=n.outerWidth(),o=n.outerHeight(),a=null,r=null,l=0;l<h.side.length;l++){if(i=e=null,"t"===(t=h.side.charAt(l)))i=d.top-o-(void 0!==h.tDistance?h.tDistance:h.yDistance);else if("T"===t)i=d.top+(void 0!==h.TDistance?h.TDistance:h.yDistance);else if("b"===t)i=d.top+c+(void 0!==h.bDistance?h.bDistance:h.yDistance);else if("B"===t)i=d.top+c-o-(void 0!==h.BDistance?h.BDistance:h.yDistance);else if("l"===t)e=d.left-s-(void 0!==h.lDistance?h.lDistance:h.xDistance);else if("L"===t)e=d.left+(void 0!==h.LDistance?h.LDistance:h.xDistance);else if("r"===t)e=d.left+u+(void 0!==h.rDistance?h.rDistance:h.xDistance);else{if("R"!==t)continue;e=d.left+u-s-(void 0!==h.RDistance?h.RDistance:h.xDistance)}if(null!==e&&p<=e&&e+s-p<g||null!==i&&f<=i&&i+o-f<m){a=e,r=i;break}null===a&&null===r&&(a=e,r=i)}null===a&&(a=d.left+h.xOffset),null===r&&(r=d.top+h.yOffset),h.fitOnScreen&&(a=Math.max(Math.min(a,p+g-s),p),r=Math.max(Math.min(r,f+m-o),f)),b(this).move(a,r,"absolute")})},b.fn.proxyTouchEvents=function(t){var a="gravy-proxy-touch-state";function r(t,e,i,n){var s=document.createEvent("MouseEvent");s.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,n||null),t.target.dispatchEvent(s)||t.preventDefault()}return t=t||"touchstart touchmove touchend",b(this).on(t,function(t){var e,i,n,s=b(this),o=t.originalEvent.changedTouches;if(1===o.length)switch(e=t.originalEvent.changedTouches[0],t.type){case"touchstart":s.data(a,{lastEl:document.elementFromPoint(e.clientX,e.clientY)}),r(t,"mousedown",e);break;case"touchmove":n=s.data(a),i=document.elementFromPoint(e.clientX,e.clientY),n.lastEl!==i&&(r(t,"mouseout",e,n.lastEl),r(t,"mouseover",e,n.lastEl=i)),r(t,"mousemove",e);break;case"touchend":case"touchcancel":r(t,"mouseup",e),s.data(a,null)}})},b.extend(String.prototype,{strip:function(){return console.warn("String.strip() is deprecated and will be removed in Djblets 6.0. Use String.trim instead."),this.trim()},stripTags:function(){return console.warn("String.stripTags() is deprecated and will be removed in Djblets 6.0. "),this.replace(/<\/?[^>]+>/gi,"")},htmlEncode:function(){return console.warn("String.htmlEncode() is deprecated and will be removed in Djblets 6.0. Use _.escape() instead."),_.escape(this)},htmlDecode:function(){return console.warn("String.htmlDecode() is deprecated and will be removed in Djblets 6.0. Use _.unescape() instead."),_.unescape(this)},truncate:function(t){console.warn("String.truncate() is deprecated and will be removed in Djblets 6.0. "),t=t||100;var e=this.toString();return this.length>t&&(-1!==(t=(e=this.substring(0,t-3)).lastIndexOf("."))&&(e=e.substring(0,t+1)),e+="..."),e}}),Djblets.getObjectByName=function(t,e){e=t.split(".").reduce(function(t,e){return t[e]},e||window);return console.assert(e,'Invalid class path "'+t+'".'),e},r=jQuery,i=""===r('<img src="">')[0].srcset,Djblets.enableRetinaImages=function(t,e){var a=window.devicePixelRatio;console.warn("Djblets.enableRetinaImages() is deprecated and will be removed in Djblets 6.0. Images with high-DPI versions should use native browser srcset."),1===a||i||(a=Math.ceil(a),(t=t||r(document.body)).find(e=e||"img").each(function(){var t,e,i,n=r(this),s=n.attr("srcset"),o=n.data("srcset-shimmed-at");if(s&&o!==a)for(t=function(t){for(var e,i,n={},s=t.split(","),o=0;o<s.length;o++)i=(e=s[o].trim().split(" "))[0],n[2!==e.length?e[1]:"1x"]=i;return n}(s),e=a;0<e;e--)if(void 0!==(i=t[e+"x"])){n.attr("src",i).data("srcset-shimmed-at",a);break}}))},r.fn.retinaGravatar=function(){return console.warn("$.retinaGravatar() is deprecated and will be removed in Djblets 6.0. Any code using gravatars should be updated to use djblets.avatars."),1<window.devicePixelRatio&&r(this).each(function(){var t=r(this);t.attr("src",Djblets.getGravatarForDisplay(t.attr("src"))).removeClass("gravatar").addClass("gravatar-retina")}),this},Djblets.getGravatarForDisplay=function(t){if(console.warn("Djblets.getGravatarForDisplay() is deprecated and will be removed in Djblets 6.0. Any code using gravatars should be updated to use djblets.avatars."),1<window.devicePixelRatio){var e,i,n,s,o=t.split("?",2);if(2===o.length){for(i=o[0],e=o[1].split("&"),s=0;s<e.length;s++)2===(n=e[s].split("=",2)).length&&"s"===n[0]&&(n=parseInt(n[1],10),e[s]="s="+Math.floor(n*window.devicePixelRatio));t=i+"?"+e.join("&")}else console.log("Failed to parse URL for gravatar "+t)}return t},(e=jQuery).widget("ui.autoSizeTextArea",{options:{fadeSpeedMS:200,growOnKeyUp:!0,minHeight:100},_init:function(){var t=this;this._proxyEl=e("<pre>").appendTo("body").move(-1e4,-1e4,"absolute"),this._proxyEl.css({border:0,font:this.element.css("font"),margin:0,padding:0,"white-space":"pre-wrap","word-wrap":"break-word"}),this.element.css("overflow","hidden"),this.oldLength=this.element.val().length,this.options.growOnKeyUp&&this.element.keyup(function(){t.autoSize()})},destroy:function(){this._proxyEl.remove(),e.Widget.prototype.destroy.call(this)},autoSize:function(t,e,i){var n=!1,s=this.element,o=s[0],a=s.val().length,r=0,l=s.height(),o=o.scrollHeight+(l-o.clientHeight);o!==l?(n=!0,r=o):(this.oldLength>a||t)&&(n=!0,this._proxyEl.width(s.width()).move(-1e4,-1e4).text(this.element.val()+"\n"),r=this._proxyEl.innerHeight()),n&&(l=Math.max(this.options.minHeight-s.getExtents("p","tb"),r),(e?s.height(i).animate({height:l},this.options.fadeSpeedMS):s.height(l)).triggerHandler("resize")),this.oldLength=a},setMinHeight:function(t){this.options.minHeight=t,this.autoSize(!0)}}),(n=jQuery).widget("ui.inlineEditor",{options:{cls:"",deferEventSetup:!1,editIconClass:null,editIconPath:null,enabled:!0,extraHeight:100,fadeSpeedMS:200,focusOnOpen:!0,forceOpen:!1,formatResult:null,hasRawValue:!1,matchHeight:!0,multiline:!1,notifyUnchangedCompletion:!1,promptOnCancel:!0,rawValue:null,showButtons:!0,showEditIcon:!0,startOpen:!1,stripTags:!1,useEditIconOnly:!1,createMultilineField:function(){return n("<textarea>").autoSizeTextArea()},setFieldValue:function(t,e){t._field.val(e)},getFieldValue:function(t){return t._field.val()},isFieldDirty:function(t,e){var i=t.options.getFieldValue(t)||"",t=(t.options.hasRawValue?i:i.htmlEncode())||"";return t.length!==e.length||t!==e}},_create:function(){var t,e=this;console.warn("$.inlineEditor is deprecated and will be removed in Djblets 6.0."),this._initialValue=null,this._editing=!1,this._dirty=!1,this._dirtyCalcScheduled=!1,this._form=n("<form>").addClass("inline-editor-form "+this.options.cls).css("display","inline").insertBefore(this.element).hide(),this.options.multiline?this._field=this.options.createMultilineField(this).on("resize",_.bind(function(){this.element.triggerHandler("resize")},this)):this._field=n('<input type="text">'),this._isTextArea="TEXTAREA"===this._field[0].tagName,this.options.deferEventSetup||this.setupEvents(),this._buttons=null,this.options.showButtons&&(this.options.multiline?this._buttons=n("<div>"):this._buttons=n("<span>"),this._buttons.addClass("buttons").appendTo(this._form),this._buttons.hide(),n('<input type="button">').val(gettext("OK")).addClass("save").appendTo(this._buttons).click(function(){e.submit()}),n('<input type="button">').val(gettext("Cancel")).addClass("cancel").appendTo(this._buttons).click(function(){e.cancel()})),this._editIcon=null,this.options.showEditIcon&&(this._editIcon=n("<a>").attr({"aria-label":gettext("Edit this field"),href:"#",role:"button"}).addClass("editicon").click(function(){return e.startEdit(),!1}),this.options.editIconPath?this._editIcon.append('<img src="'+this.options.editIconPath+'">'):this.options.editIconClass&&this._editIcon.append('<div class="'+this.options.editIconClass+'"></div>'),this.options.showRequiredFlag&&this._editIcon.append(n("<span>").attr({"aria-label":gettext("This field is required"),title:gettext("This field is required")}).addClass("required-flag").text("*")),this.options.multiline?this.element[0].id&&this._editIcon.appendTo(n("label[for="+this.element[0].id+"]")):this._editIcon.insertAfter(this.element)),this.options.useEditIconOnly||(t=!0,this.element.on("click","a",function(t){t.stopPropagation()}).click(function(){return t||e.startEdit(),!(t=!0)}).mousedown(function(){t=!1,n(this).one("mousemove",function(){t=!0})}).mouseup(function(){n(this).off("mousemove")})),n(window).resize(function(){e._fitWidthToParent()}),(this.options.forceOpen||this.options.startOpen)&&e.startEdit(!0),this.options.enabled?e.enable():e.disable()},setupEvents:function(){var e=this;this._field.prependTo(this._form).keydown(function(t){switch(t.stopPropagation(),t.keyCode||t.charCode||t.which){case n.ui.keyCode.ENTER:e.options.forceOpen||e.options.multiline&&!t.ctrlKey||e.submit(),e.options.multiline||t.preventDefault();break;case n.ui.keyCode.ESCAPE:e.options.forceOpen||e.cancel();break;case 83:case 115:if(t.ctrlKey)return e.submit(),!1}}).keypress(function(t){t.stopPropagation()}).keyup(function(){return e._scheduleUpdateDirtyState(),!1})},enable:function(){this._editing&&this.showEditor(),this._editIcon&&this._editIcon.show(),this.options.enabled=!0},disable:function(){this._editing&&this.hideEditor(),this._editIcon&&this._editIcon.hide(),this.options.enabled=!1},startEdit:function(t){var e;!this._editing&&this.options.enabled&&(e=this.options.hasRawValue?(this._initialValue=this.options.rawValue,this._initialValue):(this._initialValue=this.element.text(),this._normalizeText(this._initialValue).htmlDecode()),this._editing=!0,this.options.setFieldValue(this,e),this.element.triggerHandler("beginEditPreShow"),this.showEditor(t),this.element.triggerHandler("beginEdit"))},save:function(){var t=this.value(),e=t.htmlEncode(),i=this._initialValue;this._updateDirtyState(),this._dirty&&(this.element.html(n.isFunction(this.options.formatResult)?this.options.formatResult(e):e),this._initialValue=this.element.text()),this._dirty||this.options.notifyUnchangedCompletion?(this.element.triggerHandler("complete",[t,i]),this.options.hasRawValue&&(this.options.rawValue=t)):this.element.triggerHandler("cancel",[this._initialValue])},submit:function(){this.save(),this.hideEditor()},cancel:function(t){!t&&this.options.promptOnCancel&&this.dirty()?confirm(gettext("You have unsaved changes. Are you sure you want to discard them?"))&&this.cancel(!0):(this.hideEditor(),this.element.triggerHandler("cancel",[this._initialValue]))},field:function(){return this._field},value:function(){return this.options.getFieldValue(this)},setValue:function(t){this.options.setFieldValue(this,t),this._updateDirtyState()},buttons:function(){return this._buttons},editing:function(){return this._editing},showEditor:function(t){var e,i,n=this;this._editIcon&&(this.options.multiline&&!t?this._editIcon.fadeOut(this.options.fadeSpeedMS):this._editIcon.hide()),this.element.hide(),this._form.show(),this.options.multiline&&(i=(e=this.element.outerHeight())+this.options.extraHeight,this._fitWidthToParent(),this._isTextArea)&&(this.options.matchHeight?(this._field.autoSizeTextArea("setMinHeight",i).css("overflow","hidden"),t?this._field.height(i):this._field.height(e).animate({height:i},this.options.fadeSpeedMS)):this._field.autoSizeTextArea("autoSize",!0,!1,e)),this._buttons&&this._buttons.show(),this._field.queue(function(){n.options.multiline&&n._isTextArea&&n._field.css("overflow","auto"),n._fitWidthToParent(),n.options.focusOnOpen&&n._field.focus(),n.options.multiline||n._field[0].select(),n._field.dequeue()})},hideEditor:function(){var t=this;t.options.forceOpen||(this._field.blur(),this._buttons&&this._buttons.hide(),this._editIcon&&(this.options.multiline?this._editIcon.fadeIn(this.options.fadeSpeedMS):this._editIcon.show()),this.options.multiline&&this.options.matchHeight&&this._editing&&this._isTextArea&&this._field.css("overflow","hidden").animate({height:this.element.outerHeight()},this.options.fadeSpeedMS),this._field.queue(function(){t.element.show(),t._form.hide(),t._field.dequeue()}),this._editing=!1,this._updateDirtyState())},dirty:function(){return this._dirtyCalcScheduled&&this._updateDirtyState(),this._dirty},_scheduleUpdateDirtyState:_.throttle(function(){this._dirtyCalcScheduled=!0,_.defer(this._updateDirtyState)},200),_updateDirtyState:function(){var t=this._editing&&this.options.isFieldDirty(this,this._normalizeText(this._initialValue));this._dirty!==t&&(this._dirty=t,this.element.triggerHandler("dirtyStateChanged",[this._dirty])),this._dirtyCalcScheduled=!1},_fitWidthToParent:function(){var t,e,i,n,s,o=0;this._editing&&(this.options.multiline?this._field.css({"-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box",width:"100%"}):((i="left"===(e=(t=this._form.parent()).css("text-align")))||t.css("text-align","left"),s="border-box"===(s=this._field.css("box-sizing"))?"m":"padding-box"===s?"p":"bmp",!this._buttons||"inline"!==(n=this._buttons.css("display"))&&"inline-block"!==n||(o=this._buttons.outerWidth()),this._field.width(0).outerWidth(t.innerWidth()-(this._form.offset().left-t.offset().left)-this._field.getExtents(s,"lr")-o),i||t.css("text-align",e)))},_normalizeText:function(t){return this.options.stripTags&&(t=(t=t.replace(/<br>/g,"\n")).stripTags().strip()),t=this.options.multiline?t:t.replace(/\s{2,}/g," ")}}),n.ui.inlineEditor.getter="dirty field value",n.expr[":"].inlineEditorDirty=function(t){return n(t).inlineEditor("dirty")};{var l=jQuery;let n=[];function h(t){var e;0===n.length||(e=n[n.length-1]).box[0].contains(t.target)||(t.stopPropagation(),e.inner.focus())}l.widget("ui.modalBox",{options:{buttons:[l('<input type="button">').val(gettext("Close"))],container:"body",discardOnClose:!0,fadeBackground:!0,modalBoxButtonsClass:"modalbox-buttons",modalBoxContentsClass:"modalbox-contents",modalBoxTitleClass:"modalbox-title",stretchX:!1,stretchY:!1,title:null},_onKeyDown:function(t){t.stopPropagation(),"Escape"===t.key&&this.element.trigger("close")},_init:function(){var i=this;n.push(this),this._onKeyDown=this._onKeyDown.bind(this),this._eventID=_.uniqueId("modalbox-"),this._titleID=_.uniqueId("modalbox-title-"),this.options.fadeBackground&&(this.bgbox=l("<div>").addClass("modalbox-bg").attr("aria-hidden","true").css({"background-color":"#000",opacity:0}).move(0,0,"fixed").width("100%").height("100%").on("keydown",this._onKeyDown).appendTo(this.options.container)),this.box=l("<div>").addClass("modalbox").attr({"aria-labelledby":this._titleID,"aria-modal":"true",role:"dialog"}).move(0,0,"absolute").on("keydown",this._onKeyDown),l("body").on("keydown",this._onKeyDown),this.options.boxID&&this.box.attr("id",this.options.boxID),this.inner=l("<div>").addClass("modalbox-inner").attr("tabindex","0").css({height:"100%",position:"relative",width:"100%"}).appendTo(this.box),this.options.title&&(this.titleBox=l("<h1>").attr("id",this._titleID).addClass(this.options.modalBoxTitleClass).text(this.options.title).appendTo(this.inner)),this.element.addClass(this.options.modalBoxContentsClass).appendTo(this.inner),this.observer=new MutationObserver(function(){i.resize()}),this.observer.observe(this.element[0],{childList:!0,subtree:!0}),this._buttons=l("<div>").addClass(this.options.modalBoxButtonsClass).click(function(t){t.target.disabled||"INPUT"!==t.target.tagName&&"BUTTON"!==t.target.tagName||i.element.modalBox("destroy")}),l.each(this.options.buttons,function(){var t=l(this),e=t[0];"BUTTON"===e.tagName||"INPUT"===e.tagName||t.attr("role")||t.attr("role","button"),t.appendTo(i._buttons)}),this._buttons.appendTo(this.inner),this.options.fadeBackground&&this.bgbox&&this.bgbox.fadeTo(350,.85),this.box.appendTo(this.options.container),l(window).on("resize."+this._eventID,function(){i.resize()}),this.resize(),this.inner.focus(),1===n.length&&document.addEventListener("focus",h,!0)},destroy:function(){var t,e=this;this.element.data("uiModalBox")&&(-1!==(t=n.indexOf(this))&&n.splice(t,1),this.element.removeData("uiModalBox").off("resize.modalbox").css("position","static"),l(window).off("resize."+this._eventID),0===n.length&&document.removeEventListener("focus",this._onDocumentFocusChanged,!0),this.observer.disconnect(),this.options.fadeBackground&&this.bgbox.fadeOut(350,function(){e.bgbox.remove()}),this.options.discardOnClose||this.element.appendTo(this.options.container),l("body").off("keydown",this._onKeyDown),this.box.remove())},buttons:function(){return this._buttons},resize:function(){var t=l("body").getExtents("m","lr"),e=l("body").getExtents("m","tb"),i=l(window).width()-t,n=l(window).height()-e;this.options.stretchX&&this.box.width(i-this.box.getExtents("bmp","lr")-t),this.options.stretchY?(this.box.height(n-this.box.getExtents("bmp","tb")-e),this.element.height(this._buttons.position().top-this.element.position().top-this.element.getExtents("mp","tb"))):this.box.height(this.element.position().top+this.element.outerHeight(!0)+this._buttons.outerHeight(!0)),this.box.move(Math.ceil((i-this.box.outerWidth(!0))/2),Math.ceil((n-this.box.outerHeight(!0))/2),"fixed"),this.element.triggerHandler("resize")}}),l.ui.modalBox.getter="buttons"}(s=jQuery).tooltip=function(t,e){e=s.extend({side:"b"},e);var i=s("<div>").addClass("tooltip").hide().appendTo("body");return t.mouseenter(function(){i.children()&&i.positionToSide(t,{distance:10,side:e.side}).show()}).mouseleave(function(){i.hide()}),i},t=jQuery,o={},a={},t.funcQueue=function(i){var t=this;return o[i]||(o[i]=[]),this.add=function(t,e){t&&o[i].push([t,e])},this.next=function(){var t,e;a[i]&&((e=o[i].shift())?(t=e[0],e=e[1],t.call(e)):a[i]=!1)},this.start=function(){!a[i]&&0<o[i].length&&(a[i]=!0,t.next())},this.clear=function(){a[i]=!(o[i]=[])},this},$.fn.bindClass=function(e,i,n,s){function t(){var t=e.get(i);(t=s&&s.inverse?!t:t)?this.addClass(n):this.removeClass(n)}return e.on("change:"+i,t,this),t.call(this),this},$.fn.bindProperty=function(e,i,n,s){function t(){var t=i.get(n);void 0!==s.radioValue&&(t=s.radioValue===t),s.inverse&&(t=!t),"text"===e||"html"===e?o[e]()!==t&&o[e](null==t?"":t):o.prop(e)!==t&&o.prop(e,t)}var o=this;return(s=_.defaults(s||{},{elementToModel:!0,inverse:!1,modelToElement:!0,radioValue:void 0})).modelToElement&&(i.on("change:"+n,t),t()),s.elementToModel&&o.on("change",function(){var t="text"===e||"html"===e?o[e]():o.prop(e);if(s.inverse&&(t=!t),void 0!==s.radioValue){if(!t)return;t=s.radioValue}i.set(n,t)}),o},$.fn.bindVisibility=function(e,i,n){function t(){var t=e.get(i);n&&n.inverse&&(t=!t),this.toggle(t)}return e.on("change:"+i,t,this),t.call(this),this}}.call(this);
