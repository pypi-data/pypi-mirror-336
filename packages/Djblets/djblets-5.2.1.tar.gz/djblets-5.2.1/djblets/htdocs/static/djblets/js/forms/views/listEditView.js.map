{"version":3,"file":"listEditView.js","names":["entryTemplate","_","template","Djblets","Forms","ListEditView","Backbone","View","extend","events","initialize","options","_removeText","removeText","_fieldName","fieldName","_renderedDefaultRow","renderedDefaultRow","_numItems","_$numRowsEl","render","$el","data","_$list","children","find","length","_$addBtn","$","val","_createDefaultEntry","index","rowID","uniqueId","renderedRowHTML","replaceAll","$entry","_updateEntryInputName","$inputs","each","idx","el","attr","_addItem","e","preventDefault","stopPropagation","append","_removeItem","$target","target","closest","remove","$defaultEntry","replaceWith"],"sources":["../../../../../../static/djblets/js/forms/views/listEditView.es6.js"],"sourcesContent":["(function() {\n\n\nconst entryTemplate = _.template(dedent`\n    <li class=\"djblets-c-list-edit-widget__entry\"\n        data-list-index=\"<%- index %>\">\n     <%= renderedDefaultRow %>\n     <a href=\"#\" class=\"djblets-c-list-edit-widget__remove-item\"\n        role=\"button\" title=\"<%- removeText %>\">\n       <span class=\"fa fa-times\"></span>\n     </a>\n    </li>\n`);\n\n/**\n * A view for editing a list of elements.\n *\n * This is the JavaScript view for\n * :py:class:`djblets.forms.widgets.ListEditWidget`.\n */\nDjblets.Forms.ListEditView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-list-edit-widget__add-item': '_addItem',\n        'click .djblets-c-list-edit-widget__remove-item': '_removeItem',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Version Changed:\n     *     3.0:\n     *     * Removed the `inputAttrs` option.\n     *     * Removed the `sep` option.\n     *     * Added the `fieldName` option.\n     *     * Added the `renderedDefaultRow` option.\n     *\n     * Args:\n     *     options (object):\n     *         The view options.\n     *\n     * Option Args:\n     *     removeText (string):\n     *         The localized text for removing an item.\n     *\n     *     fieldName (string):\n     *         The form field name corresponding to this ListEditWidget.\n     *\n     *     renderedDefaultRow (string):\n     *         The HTML for a default item in the list. This is used to\n     *         render a default item when adding a new item to the list.\n     */\n    initialize(options) {\n        this._removeText = options.removeText;\n        this._fieldName = options.fieldName;\n        this._renderedDefaultRow = options.renderedDefaultRow;\n        this._numItems = 0;\n        this._$numRowsEl = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Since most of the view is rendered by Django, this just sets up some\n     * event listeners.\n     *\n     * Returns:\n     *     Djblets.Forms.ListEditView:\n     *     This view.\n     */\n    render() {\n        this.$el.data('djblets-list-edit-view', this);\n\n        this._$list = this.$el.children(\n            '.djblets-c-list-edit-widget__entries');\n        this._numItems =\n            this._$list.find('.djblets-c-list-edit-widget__entry').length;\n        this._$addBtn = this.$el.children(\n            '.djblets-c-list-edit-widget__add-item');\n\n        this._$numRowsEl = this.$(`input[name=\"${this._fieldName}_num_rows\"]`)\n            .val(this._numItems);\n\n        return this;\n    },\n\n    /**\n     * Create and format the HTML for a new entry in the list.\n     *\n     * Args:\n     *     index (int):\n     *         The index of the new entry in the list of entries.\n     *\n     * Returns:\n     *     jQuery:\n     *     The HTML for the new entry in the list.\n     */\n    _createDefaultEntry(index) {\n        const rowID = _.uniqueId('djblets-list-edit-row');\n        const renderedRowHTML = this._renderedDefaultRow\n            .replaceAll('__EDIT_LIST_ROW_ID__', rowID)\n            .replaceAll('__EDIT_LIST_ROW_INDEX__', index);\n\n        const $entry = $(entryTemplate({\n            index: index,\n            removeText: this._removeText,\n            renderedDefaultRow: renderedRowHTML,\n        }));\n        this._updateEntryInputName($entry, index);\n        this._$numRowsEl.val(index + 1);\n\n        return $entry;\n    },\n\n    /**\n     * Update attributes for an entry.\n     *\n     * This will update the form element name and ID of the\n     * ``.djblets-c-list-edit-widget__input`` elements in an entry to reflect\n     * their position in the list, guaranteeing unique names.\n     *\n     * Args:\n     *     $entry (jQuery):\n     *         The entry to update.\n     *\n     *     index (int):\n     *         The index of the entry in the list of entries.\n     */\n    _updateEntryInputName($entry, index) {\n        const $inputs = $entry.find('.djblets-c-list-edit-widget__input');\n        const fieldName = this._fieldName;\n\n        // The entry may have more than one \"input\".\n        if ($inputs.length > 1) {\n            $inputs.each((idx, el) =>\n                $(el).attr('name', `${fieldName}_value[${index}]_${idx}`));\n        } else {\n            $inputs.attr('name', `${fieldName}_value[${index}]`);\n        }\n    },\n\n    /**\n     * Add an item to the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _addItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._$list.append(this._createDefaultEntry(this._numItems));\n        this._numItems += 1;\n    },\n\n    /**\n     * Remove an item.\n     *\n     * When there is only a single item in the list, we clear it instead of\n     * removing it so there is always at least one item in the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _removeItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $target = $(e.target);\n        const $entry = $target.closest('.djblets-c-list-edit-widget__entry');\n\n        if (this._numItems > 1) {\n            $entry.remove();\n            this._numItems -= 1;\n            this._$list.find('.djblets-c-list-edit-widget__entry')\n                .each((idx, el) => {\n                    const $el = $(el);\n                    $el.attr('data-list-index', idx);\n                    this._updateEntryInputName($el, idx);\n                });\n            this._$numRowsEl.val(this._numItems);\n        } else {\n            const $defaultEntry = this._createDefaultEntry(0);\n            $entry.replaceWith($defaultEntry);\n        }\n    },\n});\n\n\n})();\n"],"mappings":"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"}