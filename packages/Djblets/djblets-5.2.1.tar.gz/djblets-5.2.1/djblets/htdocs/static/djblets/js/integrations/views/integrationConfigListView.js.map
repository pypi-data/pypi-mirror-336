{"version":3,"file":"integrationConfigListView.js","names":["IntegrationConfigItem","Djblets","Config","ListItem","extend","defaults","_","removeLabel","showRemove","prototype","url","get","parse","data","editURL","id","integrationID","itemState","enabled","name","IntegrationConfigItemView","TableItemView","className","actionHandlers","template","getRenderContext","model","integration","collection","options","integrationsMap","iconSrc","iconSrcSet","integrationName","_onDeleteClicked","$","text","modalBox","buttons","click","destroy","beforeSend","xhr","setRequestHeader","csrfToken","title","IntegrationConfigListView","Backbone","View","events","addIntegrationPopupViewType","AddIntegrationPopupView","listItemType","listItemViewType","listItemsCollectionType","ListItems","listViewType","TableView","initialize","_integrationIDs","integrationIDs","_integrationsMap","list","List","configs","_popup","render","listView","ItemView","el","$el","removeAttr","_$listContainer","parent","listenTo","_showOrHideConfigsList","length","show","hide","_onAddIntegrationClicked","e","preventDefault","stopPropagation","integrations","i","push","appendTo","target"],"sources":["../../../../../../static/djblets/js/integrations/views/integrationConfigListView.es6.js"],"sourcesContent":["(function() {\n\n\n/**\n * List item for a configuration.\n *\n * This stores basic display, actions, and API information for the\n * configuration.\n */\nconst IntegrationConfigItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        removeLabel: _`Delete`,\n        showRemove: true,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Return the API URL for the item.\n     *\n     * This is the same as the ``editURL`` attribute, and is used to\n     * perform HTTP DELETE requests.\n     *\n     * Returns:\n     *     string:\n     *     The URL to perform API operations on.\n     */\n    url() {\n        return this.get('editURL');\n    },\n\n    /**\n     * Return the attributes for this item from a provided payload.\n     *\n     * Args:\n     *     data (object):\n     *         The data for this item provided when constructing the\n     *         integrations page.\n     *\n     * Returns:\n     *     object:\n     *     The new attribute data from the item.\n     */\n    parse(data) {\n        return {\n            editURL: data.editURL,\n            id: data.id,\n            integrationID: data.integrationID,\n            itemState: data.enabled ? 'enabled' : 'disabled',\n            name: data.name,\n        };\n    },\n});\n\n\n/**\n * View for displaying information and actions for a configuration.\n *\n * This renders some basic information on the state of the configuration,\n * and provides actions for deleting configurations.\n */\nconst IntegrationConfigItemView = Djblets.Config.TableItemView.extend({\n    className:\n        'djblets-c-integration-config djblets-c-config-forms-list__item',\n\n    actionHandlers: {\n        'delete': '_onDeleteClicked',\n    },\n\n    template: _.template(dedent`\n        <td class=\"djblets-c-integration-config__name\">\n         <img src=\"<%- iconSrc %>\"\n              srcset=\"<%- iconSrcSet %>\"\n              width=\"32\" height=\"32\" alt=\"\">\n         <a href=\"<%- editURL %>\"><%- name %></a>\n        </td>\n        <td class=\"djblets-c-integration-config__integration-name\">\n         <%- integrationName %>\n        </td>\n        <td class=\"djblets-c-config-forms-list__item-state\"></td>\n        <td></td>\n    `),\n\n    /**\n     * Return context data for rendering the item's template.\n     *\n     * Returns:\n     *     object:\n     *     Context data for the render.\n     */\n    getRenderContext() {\n        const integrationID = this.model.get('integrationID');\n        const integration =\n            this.model.collection.options.integrationsMap[integrationID];\n\n        return {\n            iconSrc: integration.iconSrc,\n            iconSrcSet: integration.iconSrcSet,\n            integrationName: integration.name,\n        };\n    },\n\n    /**\n     * Handle the Delete action on the item.\n     *\n     * This will display a confirmation dialog, and then send an HTTP DELETE\n     * to remove the configuration.\n     */\n    _onDeleteClicked() {\n        $('<p>')\n            .text(_`\n                This integration will be permanently removed. This cannot\n                be undone.\n            `)\n            .modalBox({\n                buttons: [\n                    $('<button>')\n                        .text(_`Cancel`),\n                    $('<button class=\"danger\">')\n                        .text(_`Delete Integration`)\n                        .click(() => this.model.destroy({\n                            beforeSend: xhr => {\n                                xhr.setRequestHeader(\n                                    'X-CSRFToken',\n                                    this.model.collection.options.csrfToken);\n                            },\n                        })),\n                ],\n                title: _`Are you sure you want to delete this integration?`,\n            });\n    },\n});\n\n\n/**\n * View for managing the integration configurations list.\n *\n * This handles events for the Add Integration button and the resulting popup.\n */\nDjblets.IntegrationConfigListView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-integration-configs__add':\n            '_onAddIntegrationClicked',\n    },\n\n    addIntegrationPopupViewType: Djblets.AddIntegrationPopupView,\n    listItemType: IntegrationConfigItem,\n    listItemViewType: IntegrationConfigItemView,\n    listItemsCollectionType: Djblets.Config.ListItems,\n    listViewType: Djblets.Config.TableView,\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     configs (Array):\n     *         An array of data on the configurations, in display order.\n     *\n     *     integrationIDs (Array):\n     *         An array of integration IDs, in display order.\n     *\n     *     integrationsMap (object):\n     *         A mapping of integration ID to information.\n     */\n    initialize(options) {\n        this._integrationIDs = options.integrationIDs;\n        this._integrationsMap = options.integrationsMap;\n\n        this.list = new Djblets.Config.List(\n            {},\n            {\n                collection: new this.listItemsCollectionType(\n                    options.configs,\n                    {\n                        csrfToken: options.csrfToken,\n                        integrationsMap: options.integrationsMap,\n                        model: this.listItemType,\n                        parse: true,\n                    }\n                ),\n            });\n\n        this._popup = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     Djblets.IntegrationConfigListView:\n     *     This view, for chaining.\n     */\n    render() {\n        this.listView = new this.listViewType({\n            ItemView: this.listItemViewType,\n            el: this.$('.djblets-c-config-forms-list'),\n            model: this.list,\n        });\n        this.listView.render().$el\n            .removeAttr('aria-busy');\n\n        this._$listContainer = this.listView.$el.parent();\n\n        this.listenTo(this.list.collection, 'add remove',\n                      this._showOrHideConfigsList);\n        this._showOrHideConfigsList();\n\n        return this;\n    },\n\n    /**\n     * Show or hide the list of configurations.\n     *\n     * This will show the list's container if there's at least one item to\n     * show, or hide it if the list is empty.\n     */\n    _showOrHideConfigsList() {\n        if (this.list.collection.length > 0) {\n            this._$listContainer.show();\n        } else {\n            this._$listContainer.hide();\n        }\n    },\n\n    /**\n     * Handler for the Add Integration button.\n     *\n     * This will show the integrations list popup, allowing the user to choose\n     * an integration to add.\n     *\n     * The logic for showing the popup will align the popup with the left-hand\n     * side of the Add Integration button, and set the width to the maximum\n     * amount that will cleanly fit a row of tiles without obscuring any part\n     * of a tile or leaving extra space after a tile.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onAddIntegrationClicked(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!this._popup) {\n            const integrationIDs = this._integrationIDs;\n            const integrationsMap = this._integrationsMap;\n            const integrations = [];\n\n            for (let i = 0; i < integrationIDs.length; i++) {\n                integrations.push(integrationsMap[integrationIDs[i]]);\n            }\n\n            this._popup = new this.addIntegrationPopupViewType({\n                integrations: integrations,\n            });\n            this._popup.render().$el.appendTo(this.$el);\n        }\n\n        this._popup.show($(e.target));\n    },\n});\n\n\n})();\n"],"mappings":"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"}