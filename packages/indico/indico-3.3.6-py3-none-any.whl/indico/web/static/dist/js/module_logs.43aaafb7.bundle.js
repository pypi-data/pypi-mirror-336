"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1207],{64300:(e,t,n)=>{var r=n(86326),a=n(35623),s=n(44515),i=n(88996),l=n(88183),c=n.n(l),o=n(49528);const u="SET_KEYWORD",m="SET_FILTER",d="SET_PAGE",p="UPDATE_ENTRIES",g="FETCH_STARTED",h="FETCH_FAILED",E="SET_DETAILED_VIEW",y="SET_METADATA_QUERY",f="SET_INITIAL_REALMS";function w(e){return{type:d,currentPage:e}}function x(e){return{type:E,currentViewIndex:e}}function b(e){return{type:y,metadataQuery:e}}function N(){return async(e,t)=>{e({type:g});const{logs:{filters:n,keyword:r,currentPage:a,metadataQuery:s},staticData:{fetchLogsUrl:i}}=t(),l={page:a,filters:[],meta:s};let u;r&&(l.q=r),Object.entries(n).forEach((([e,t])=>{t&&l.filters.push(e)}));try{u=await o.indicoAxios.get(i,{params:l,paramsSerializer:e=>c().stringify(e,{arrayFormat:"repeat",allowDots:!0})})}catch(t){return(0,o.handleAxiosError)(t),void e({type:h})}const{entries:m,pages:d,total_page_count:E}=u.data;e(function(e,t,n){return{type:p,entries:e,pages:t,totalPageCount:n}}(m,d,E))}}var T=n(96478),P=n(36111),v=n(14867),D=n.n(v),R=n(97598),C=n.n(R),I=n(68803),k=n(70827),V=n(94900);class S extends r.Component{constructor(e){super(e),this.modal=void 0,this.onClose=this.onClose.bind(this),this.prevEntry=this.prevEntry.bind(this),this.nextEntry=this.nextEntry.bind(this),this.relatedEntries=this.relatedEntries.bind(this)}componentDidUpdate(){const{currentViewIndex:e}=this.props;null!==e&&this.open()}open(){this.modal.open()}onClose(){const{setDetailedView:e}=this.props;e(null)}prevEntry(){const{prevEntry:e}=this.props;e()}nextEntry(){const{nextEntry:e}=this.props;e()}relatedEntries(){const{relatedEntries:e}=this.props;e()}_isFirstEntry(){const{currentPage:e,currentViewIndex:t}=this.props;return 1===e&&0===t}_isLastEntry(){const{currentPage:e,totalPageCount:t,currentViewIndex:n,entries:r}=this.props;return e===t&&n===r.length-1}_hasRelatedEntries(){const{currentViewIndex:e,entries:t}=this.props,n=t[e];return 0!==Object.keys(n.meta).length}render(){const{currentViewIndex:e,entries:t}=this.props;if(null===e)return"";const{description:n,html:a,user:{fullName:s},time:i}=t[e];return r.createElement(k.Modal,{title:n,ref:e=>{this.modal=e},onClose:this.onClose,contentLabel:"Details about log entry",fixedFooter:!0},r.createElement(V.Slot,null,r.createElement("table",{className:"i-table log-modal-details",dangerouslySetInnerHTML:{__html:a}}),r.createElement("div",{className:"text-superfluous log-modal-author-info flexrow f-j-end"},r.createElement("span",null,s&&r.createElement("span",{className:"log-modal-user"},s," "),"on",r.createElement("span",{className:"log-modal-time"}," ",D()(i).format("ddd, D/M/YYYY HH:mm"))))),r.createElement(V.Slot,{name:"footer"},r.createElement("div",{className:"group flexrow f-j-space-between"},r.createElement(k.IButton,{title:T.Translate.string("Previous"),icon:"prev",onClick:this.prevEntry,disabled:this._isFirstEntry()},r.createElement(T.Translate,null,"Previous")),r.createElement(k.IButton,{onClick:this.relatedEntries,disabled:!this._hasRelatedEntries()},r.createElement(T.Translate,null,"Related entries")),r.createElement(k.IButton,{title:T.Translate.string("Next"),classes:{next:!0},highlight:!0,onClick:this.nextEntry,disabled:this._isLastEntry()},r.createElement(T.Translate,null,"Next")))))}}(0,P.A)(S,"propTypes",{entries:C().array.isRequired,currentViewIndex:C().number,setDetailedView:C().func.isRequired,prevEntry:C().func.isRequired,nextEntry:C().func.isRequired,relatedEntries:C().func.isRequired,currentPage:C().number.isRequired,totalPageCount:C().number.isRequired}),(0,P.A)(S,"defaultProps",{currentViewIndex:null});const q=(0,s.connect)((({logs:e})=>({currentViewIndex:e.currentViewIndex,currentPage:e.currentPage,totalPageCount:e.totalPageCount})),(e=>({setDetailedView:t=>{e(x(t))},prevEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:n},logs:{currentViewIndex:r,currentPage:a}}=t();0===r?0===a||(await e(w(a-1)),await e(N()),await e(x(n-1))):e({type:E,currentViewIndex:r-1})}))},nextEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:n},logs:{currentViewIndex:r,currentPage:a,pages:s}}=t();r===n-1?a===s[s.length-1]||(await e(w(a+1)),await e(x(0)),await e(N())):e({type:E,currentViewIndex:r+1})}))},relatedEntries:()=>{e(((e,t)=>{const{logs:{entries:n,currentViewIndex:r}}=t(),a=n[r],s=c().stringify({meta:a.meta},{allowDots:!0});e(b(a.meta)),e(w(1)),e(x(null)),e(N()),history.replaceState({},null,`${location.pathname}?${s}`)}))}})))(S);class F extends r.PureComponent{constructor(e){super(e),this.openDetails=this.openDetails.bind(this)}openDetails(e){const{setDetailedView:t}=this.props;t(e)}iconProps(e){if("email"===e.type)switch(e.payload.state){case"pending":return{className:"log-icon semantic-text warning",title:T.Translate.string("This email is pending and will be sent soon."),"data-qtip-style":"warning"};case"sent":return{className:"log-icon semantic-text success",title:T.Translate.string("This email has been sent."),"data-qtip-style":"success"};case"failed":return{className:"log-icon semantic-text error",title:T.Translate.string("Sending this email failed."),"data-qtip-style":"danger"}}return{className:"log-icon"}}entryKind(e){if("email"!==e.type)return e.kind;return{pending:"change",sent:"positive",failed:"negative"}[e.payload.state]||"other"}render(){const{entry:e}=this.props;return r.createElement("li",{className:`log-realm-${e.realm} log-kind-${this.entryKind(e)}`},r.createElement("span",{className:"log-module"},r.createElement("span",this.iconProps(e),r.createElement("i",{className:"log-realm"}),r.createElement("i",{className:"log-kind icon-circle-small"})),r.createElement("span",{className:"bold"},e.module)),r.createElement(k.TooltipIfTruncated,null,r.createElement("span",{className:"log-entry-description",onClick:()=>this.openDetails(e.index)},e.description)),r.createElement("span",{className:"log-entry-details"},r.createElement("span",{className:"logged-time",title:D()(e.time).format("DD/MM/YYYY HH:mm")},r.createElement("time",{dateTime:e.time},D()(e.time).fromNow())),e.user.avatarURL?r.createElement(I.A,{avatar:!0,title:e.user.fullName,src:e.user.avatarURL,className:"user-picture ui-qtip"}):""))}}(0,P.A)(F,"propTypes",{entry:C().object.isRequired,setDetailedView:C().func.isRequired});class _ extends r.PureComponent{renderEmpty(){return r.createElement(k.MessageBox,{type:"info"},"No logs to show")}renderSpinner(){return r.createElement("div",{className:"event-log-list-spinner"},r.createElement("div",{className:"i-spinner"}))}renderList(){const{entries:e,pages:t,currentPage:n,changePage:a,isFetching:s,setDetailedView:i}=this.props;return r.createElement(r.Fragment,null,s&&this.renderSpinner(),r.createElement("ul",{className:"event-log-list "+(s?"loading":"")},e.map((e=>r.createElement(F,{key:e.id,entry:e,setDetailedView:i})))),!s&&r.createElement(k.Paginator,{currentPage:n,pages:t,changePage:a}),r.createElement(q,{entries:e}))}render(){const{entries:e,isFetching:t}=this.props;return 0===e.length?t?this.renderSpinner():this.renderEmpty():this.renderList()}}(0,P.A)(_,"propTypes",{entries:C().array.isRequired,currentPage:C().number.isRequired,pages:C().array.isRequired,changePage:C().func.isRequired,isFetching:C().bool.isRequired,setDetailedView:C().func.isRequired});const A=(0,s.connect)((({logs:e})=>({entries:e.entries,currentPage:e.currentPage,pages:e.pages,isFetching:e.isFetching})),(e=>({changePage:t=>{e(w(t)),e(N())},setDetailedView:t=>{e(x(t))}})))(_);class L extends r.Component{render(){const{realms:e,filters:t,setFilter:n}=this.props;return r.createElement("div",{className:"toolbar"},r.createElement("div",{className:"group i-selection "+(e.length<=1?"hidden":"")},r.createElement("span",{className:"i-button label"},r.createElement(T.Translate,null,"Show")),Object.keys(e).sort().map((a=>r.createElement(r.Fragment,{key:a},r.createElement("input",{type:"checkbox",id:`realm-${a}`,"data-realm":a,defaultChecked:t[a],onChange:e=>n({[a]:e.target.checked})}),r.createElement("label",{htmlFor:`realm-${a}`,className:"i-button"},e[a]))))))}}(0,P.A)(L,"propTypes",{realms:C().object.isRequired,filters:C().object.isRequired,setFilter:C().func.isRequired});const j=(0,s.connect)((({logs:e})=>({filters:e.filters})),(e=>({setFilter:t=>{e(function(e){return{type:m,filter:e}}(t)),e(w(1)),e(N())}})))(L);var O=n(3803),Y=n.n(O);class U extends r.Component{render(){const{setKeyword:e}=this.props;return r.createElement("div",{className:"toolbar"},r.createElement("div",{className:"group"},r.createElement("span",{className:"i-button label"},r.createElement("span",{className:"icon-search"})),r.createElement("input",{type:"text",onChange:t=>e(t.target.value.trim())})))}}(0,P.A)(U,"propTypes",{setKeyword:C().func.isRequired});const M=(0,s.connect)(null,(e=>({setKeyword:Y()((t=>{e(function(e){return{type:u,keyword:e}}(t)),e(w(1)),e(N())}),250)})))(U);class Q extends r.Component{render(){const{realms:e}=this.props;return r.createElement("div",{className:"toolbars"},r.createElement(j,{realms:e}),r.createElement(M,null))}}(0,P.A)(Q,"propTypes",{realms:C().object.isRequired});const H=(0,s.connect)((({staticData:e})=>({realms:e.realms})))(Q);function K(){const e=(0,s.useDispatch)();return r.createElement("div",{className:"highlight-message-box"},r.createElement("span",{className:"icon"}),r.createElement("div",{className:"message-text"},r.createElement(T.Translate,null,"Log entries are currently filtered by URL."," ",r.createElement(T.Param,{name:"link",wrapper:r.createElement("a",{onClick:()=>{e((e=>{e(b({})),e(w(1)),e(x(null)),e(N()),history.replaceState({},null,location.pathname)}))}})},"Click here")," ","to disable the filter.")))}function $(){const e=(0,s.useSelector)((e=>e.logs.metadataQuery));return r.createElement(r.Fragment,null,0!==Object.keys(e).length&&r.createElement(K,null),r.createElement(H,null),r.createElement(A,null))}K.propTypes={};const z={entries:[],keyword:null,currentPage:1,isFetching:!1,metadataQuery:{},filters:{},pages:[],totalPageCount:0,currentViewIndex:null};function B(e=z,t){switch(t.type){case f:return{...e,filters:Object.fromEntries(t.initialRealms.map((e=>[e,!0])))};case u:return{...e,keyword:t.keyword};case m:return{...e,filters:{...e.filters,...t.filter}};case d:return{...e,currentPage:t.currentPage};case p:return{...e,entries:t.entries,pages:t.pages,totalPageCount:t.totalPageCount,isFetching:!1};case g:return{...e,isFetching:!0};case h:return{...e,isFetching:!1};case E:return{...e,currentViewIndex:t.currentViewIndex};case y:return{...e,metadataQuery:t.metadataQuery};default:return e}}window.addEventListener("load",(()=>{const e=document.querySelector(".event-log"),t={staticData:{fetchLogsUrl:e.dataset.fetchLogsUrl,realms:JSON.parse(e.dataset.realms),pageSize:15}},n=(0,i.Ay)("event-logs",{logs:B},t);var l;n.dispatch((l=Object.keys(t.staticData.realms),{type:f,initialRealms:l})),n.dispatch(b(JSON.parse(e.dataset.metadataQuery))),a.render(r.createElement(s.Provider,{store:n},r.createElement($,null)),e),n.dispatch(N())}))}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=64300,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_logs.43aaafb7.bundle.js.map