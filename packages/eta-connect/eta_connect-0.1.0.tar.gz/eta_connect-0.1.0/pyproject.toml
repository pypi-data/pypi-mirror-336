[project]
name = "eta-connect"
version = "v0.1.0"
description = "Provides a standardized way to connect to machines and devices in a factory or other factory systems"
license = "BSD-2-Clause"
readme = "README.rst"
requires-python = ">=3.9.2, <3.12"
authors = [
    {name = "Technical University of Darmstadt, Institute for Production Management, Technology and Machine Tools (PTW)", email="info@ptw.tu-darmstadt.de"}
]
keywords = [
    "connectors","servers","simulators", "eta-fabrik"
]
dynamic = ["classifiers", "dependencies"]

[project.urls]
homepage = "https://www.ptw.tu-darmstadt.de"
repository = "https://git.ptw.maschinenbau.tu-darmstadt.de/eta-fabrik/public/eta-connect"
documentation = "https://eta-utility.readthedocs.io/"  # TODO: Change to the correct URL
issues = "https://git.ptw.maschinenbau.tu-darmstadt.de/eta-fabrik/public/eta-connect/-/issues"

[tool.poetry]
# Classifiers are defined in the poetry section to dynamically add the python version
classifiers = [
    "License :: OSI Approved :: BSD License",
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Intended Audience :: Science/Research",
    "Intended Audience :: Manufacturing",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Topic :: Software Development :: Libraries",
    "Operating System :: OS Independent",
]
include = [
    {path="examples/", format=["sdist", "wheel"]}
]


#  '^' limits to the next major version, '~' limits to the next minor version
# e.g. ^3.9.0: 3.9.0 <= x < 4.0.0 and ~3.9.0: 3.9.0 <= x < 3.10.0
[tool.poetry.dependencies]
# default dependencies of eta_connect
attrs = "^23.1.0"
python-dateutil = "^2.8.2"
numpy = {version= "~1.26.0"}
pandas = {version= "~2.2.2"}
xlrd = "^2.0.1"
asyncua-fork-for-eta-utility = "==1.0.7"
lxml = "^4.9.3"
requests = "^2.31.0"
pymodbustcp = "==0.2.0"
cryptography = "^41.0.4"
fmpy = "^0.3.5"
wetterdienst = "~0.88.0"  # breaking changes expected
requests-cache = "^1.2.0"
pyyaml = "^6.0.2"
toml = "^0.10.2"

# Specific requirements for the examples
matplotlib = {version= "~3.7.0", optional = true}
onnxruntime = {version="==1.19.0", optional=true}  # Version 1.20 doesn't support Python 3.9

# Specific requirements for tests
pytest = {version = "^7.4.2", optional = true}
pytest-cov = {version = "^4.1.0", optional = true}
openpyxl = {version = "^3.1.2", optional = true}
# Specific requirements for development
sphinx = {version ="^7.1.2", optional = true}
sphinx-rtd-theme = {version = "^1.3.0", optional = true}
sphinx-copybutton = {version = "^0.5.2", optional = true}
pre-commit = {version = "^3.4.0", optional = true}
black = {version = "~23.7", optional = true}
blacken_docs = {version = "~1.16", optional = true}
# MyPy requirements and typing packages
mypy = {version = "~1.9", optional = true}
types-python-dateutil = {version = "^2.8.19.14", optional = true}
types-requests = {version = "^2.31.0.4", optional = true}
types-pytz = {version = "^2024.1.0.20240203", optional = true}
# Ruff
ruff = {version = "~0.9.0", optional = true}
codespell = {version= "^2.3.0", optional = true}
pandas-stubs = "2.2.2.240514"


[tool.poetry.extras]
examples = ["matplotlib", "onnxruntime"]
develop = ["pytest", "pytest-cov", "openpyxl", "sphinx", "sphinx-rtd-theme", "sphinx-copybutton", "pre-commit",
            "mypy", "types-python-dateutil", "types-requests", "types-pytz", "ruff", "codespell",
            "matplotlib", "onnxruntime"]    # include examples

[tool.mypy]
python_version = "3.9"
files = ["eta_connect", "examples"]
disallow_untyped_defs = true
disallow_incomplete_defs = true
no_implicit_optional = true
warn_unused_ignores = true
warn_unreachable = true
show_column_numbers = true

exclude = [
    "docs/conf.py",
    "^test/",
]

[[tool.mypy.overrides]]
module = [
    "fmpy.*",
    "pandas.*",
    "opcua.*",
    "pyModbusTCP.*",
    "lxml.*",
    "setuptools",
    "onnxruntime.*",
    "matplotlib.*",
    "asyncua.*",
    "wetterdienst.*",
    "requests_cache.*",
    "toml.*",
    "yaml.*",
]
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "test.*"
ignore_errors = true
[tool.pytest.ini_options]
filterwarnings = "ignore::DeprecationWarning:.*site-packages.*"
addopts = ["--cov-config=pyproject.toml", "--color=yes"]
log_cli = true
log_cli_level = "INFO"
log_cli_format = "[%(levelname)s: %(name)s] %(message)s"
testpaths = [
    "test",
]
markers = [
    "disable_logging: Disable logging for the marked test",
]

# Configuration for pytest-cov
[tool.coverage.run]
source = [
    "eta_connect"
]
omit = [
    "*/venv/*",
    "*/.venv/*",
    "*/docs/*",
    "*/build/*",
    "*/dist/*",
    "*/eta_connect/type_hints/*",
]

[tool.coverage.report]
exclude_lines = [
    # These lines are excluded from coverage because they are not meant to be tested
    'pragma: no cover',
    'if TYPE_CHECKING:',
    'raise NotImplementedError',
    'pass',
]

[tool.ruff]

line-length = 120
indent-width = 4

required-version = ">=0.4.0"
target-version= "py39"

# Only fix with $ruff check --fix
fix = false

output-format = "concise"

[tool.ruff.lint]
select = [
    "F",       # Pyflakes
    "E", "W",  # Pycodestyle, Error and Warning
    "I",       # Isort
    "N",       # Pep8-naming conventions
    "UP",      # Pyupgrade
    "PL",      # Pylint
    "ERA",     # Eradicate
    "PD",      # Pandas-vet
    "NPY",     # NumPy-specific
    "RUF",     # Ruff

    # Flake8:
    # 2020, asyncio, bugbear, builtins, commas, comprehensions, future-annotations, implicit-str-concat
    "YTT", "ASYNC", "B", "A", "COM", "C4", "FA", "ISC",
    # logging, no-pep420, print, pyi, pytest-style, return, simplify, use-pathlib, todo
    "LOG", "INP", "T20", "PYI", "PT", "RET", "SIM", "PTH", "TD",
    ]

ignore = [
    "PLR2004",  # Pylint: magic values
    "SIM105",   # Don't forcce contextlib.suppress
    "TD002",    # Ignore TODO authors
    # Recommended to ignore as they conflict with the formatter
    "W191", "E111", "E114", "E117", "D206", "D300", "COM812", "COM819", "ISC001",
]


[tool.ruff.lint.extend-per-file-ignores]
"__init__.py" = ["PLC0414"]
"test/*" = ["RUF012"]

[tool.ruff.lint.isort]
combine-as-imports = true
force-wrap-aliases = true

[tool.ruff.lint.pylint]
max-args = 15
max-branches = 21
max-statements = 62
max-returns = 6

[tool.codespell]
skip = "*.js, *.html, *.lock, */Manifest.toml, ./docs/_build"
ignore-words-list = ["Temperatur"]
quiet-level = 3

[build-system]
requires = ["poetry-core>=1.6.0"]
build-backend = "poetry.core.masonry.api"
