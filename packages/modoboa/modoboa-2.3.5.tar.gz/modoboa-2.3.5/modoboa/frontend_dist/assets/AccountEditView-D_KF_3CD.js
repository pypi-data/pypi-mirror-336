import{b as D,at as Q,af as J,N as z,O as H,G as f,i as C,d as K,k as W,f as n,o as s,c as m,R as p,a,w as e,S as c,t as o,e as v,J as T,U as y,_ as X}from"./index-iBY7DK1v.js";import{_ as Y,a as Z,A as ee,b as ae}from"./AccountAliasForm-Dx3qiKcO.js";import{_ as le}from"./ResourcesForm-CeEc5M4G.js";import{L as te}from"./LoadingData-B-FP4HlM.js";import{p as oe}from"./parameters-4KTQH4c2.js";import{s as x,h as E,g as L}from"./index-B-SZSIyg.js";import{V as g,c as V,a as b,b as se}from"./VExpansionPanels-D63DWUK-.js";import{a as _,V as d}from"./VRow-3ZnNVBUg.js";import{V as ue,a as re}from"./VToolbar-DKKaf1u-.js";import"./ChoiceField-DBwvW3zI.js";import"./VAlert-CmR0819b.js";import"./VProgressCircular-BaXwBt9a.js";import"./tag-B1PWMplM.js";import"./dimensions-DgLfpRRd.js";import"./VForm-DCBDn5wc.js";import"./VTextField-DYxGSp0H.js";import"./forwardRefs-CAu7KObs.js";import"./ssrBoot-BBtl5VTl.js";import"./VAvatar-CcykeumL.js";import"./AccountPasswordSubForm-UtmKgJCO.js";import"./VSwitch-BdhFnqLv.js";import"./VChip-D9Ast84G.js";import"./EmailField-D8dP5XZw.js";import"./VContainer-BgjPTvnI.js";/* empty css              */const ne={key:1},de={key:0},ie={key:0},me={class:"mr-2"},ce={class:"mr-2"},fe={key:0},_e={class:"mr-2"},ve={class:"mr-2"},pe={class:"mr-2"},ye={key:0},ke={class:"mr-2"},xe={key:0},ge={class:"mr-2"},Ve={class:"mr-2"},be={class:"mt-4 d-flex justify-end"},Fe={__name:"AccountEditForm",setup(O){const{$gettext:r}=D(),N=Q(),I=J(),S=z(),j=H(),l=f({pk:S.params.id}),F=C(()=>l.value.username&&l.value.username.indexOf("@")!==-1),R=C(()=>{const t=U.value.params&&U.value.params.enable_admin_limits&&l.value.role!=="SimpleUsers"&&l.value.role!=="SuperAdmins";return t===void 0?!1:t}),U=f({}),h=f(0),k=f(!1),w=f(!1),$=f(),M=f(),B=f(),P=f(),A=f(),q=C(()=>{const t={roleForm:$,generalForm:M};return F.value&&(t.aliasForm=P,t.mailboxForm=B),R.value&&(t.resourcesForm=A),t});async function G(){w.value=!1,h.value=[];for(const[t,i]of Object.entries(q.value))if(i.value!=null){const{valid:u}=await i.value.vFormRef.validate();u||(w.value=!0,h.value.push(t))}if(!w.value){k.value=!0;try{const t={...l.value};F.value?t.mailbox.full_address=t.username:delete t.mailbox.full_address,t.password||(delete t.password,delete t.password_confirmation),R.value&&A.value!==null&&(t.resources=A.value.getPayload()),t.aliases===null&&delete t.aliases,I.updateIdentity("account",t).then(()=>{j.push({name:"AccountDetail",params:{id:S.params.id}})})}finally{k.value=!1}}}return K(()=>{N.getAccount(S.params.id).then(t=>l.value={...t.data}),oe.getApplication("limits").then(t=>{U.value=t.data})}),W(l,()=>{delete l.value.domains,l.value.mailbox===null&&delete l.value.mailbox},{deep:!0}),(t,i)=>!n(N).accountsLoaded||k.value?(s(),m(te,{key:0})):(s(),p("div",ne,[a(se,{modelValue:h.value,"onUpdate:modelValue":i[5]||(i[5]=u=>h.value=u),multiple:w.value},{default:e(()=>[a(g,{eager:"",value:"roleForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Role")),1)]),_:1}),a(d,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",de)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(d,{cols:"6"},{default:e(()=>[c(o($.value.roleLabel),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(Y,{ref_key:"roleForm",ref:$,modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{eager:"",value:"generalForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Identification")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",ie)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(d,{cols:"6"},{default:e(()=>[v("div",me,o(n(r)("Username:"))+" "+o(l.value.username),1)]),_:1}),a(d,{cols:"6"},{default:e(()=>[v("div",ce,[c(o(n(r)("Enabled"))+" ",1),l.value.is_active?(s(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(s(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(Z,{ref_key:"generalForm",ref:M,modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=u=>l.value=u),editing:""},null,8,["modelValue"])]),_:1})]),_:1}),F.value?(s(),m(g,{key:0,eager:"",value:"mailboxForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Mailbox")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",fe)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.mailbox?(s(),p(T,{key:0},[l.value.mailbox.use_domain_quota?(s(),m(d,{key:0,cols:"6"},{default:e(()=>[v("div",_e,o(n(r)("Quota: "))+" "+o(n(r)("domain's default value")),1)]),_:1})):(s(),m(d,{key:1,cols:"6"},{default:e(()=>[v("div",ve,o(n(r)("Quota: "))+" "+o(l.value.mailbox.quota),1)]),_:1})),a(d,{cols:"6"},{default:e(()=>[v("div",pe,[c(o(n(r)("Send only"))+" ",1),l.value.mailbox.is_send_only?(s(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(s(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ee,{ref_key:"mailboxForm",ref:B,modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),F.value?(s(),m(g,{key:1,eager:"",value:"aliasForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Alias")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",ye)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.aliases?(s(),m(d,{key:0,cols:"6"},{default:e(()=>[v("div",ke,o(n(r)("Aliases:"))+" "+o(n(r)("Number of associated alias:"))+" "+o(l.value.aliases.length),1)]),_:1})):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ae,{ref_key:"aliasForm",ref:P,modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),R.value?(s(),m(g,{key:2,eager:"",value:"resourcesForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Resources")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",xe)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.resources!=null&&l.value.resources.length==2?(s(),p(T,{key:0},[a(d,{cols:"6"},{default:e(()=>[v("div",ge,o(n(r)("Mailbox:"))+" "+o(n(r)("Number of allowed mailboxes:"))+" "+o(l.value.resources[0].max_value),1)]),_:1}),a(d,{cols:"6"},{default:e(()=>[v("div",Ve,o(n(r)("Mailbox aliases:"))+" "+o(n(r)("Number of allowed mailbox aliases:"))+" "+o(l.value.resources[1].max_value),1)]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(le,{ref_key:"resourcesForm",ref:A,modelValue:l.value.resources,"onUpdate:modelValue":i[4]||(i[4]=u=>l.value.resources=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue","multiple"]),v("div",be,[a(L,{loading:k.value,onClick:i[6]||(i[6]=u=>t.$router.go(-1))},{default:e(()=>[c(o(n(r)("Cancel")),1)]),_:1},8,["loading"]),a(L,{class:"ml-4",color:"primary darken-1",loading:k.value,onClick:G},{default:e(()=>[c(o(n(r)("Save")),1)]),_:1},8,["loading"])])]))}},he={__name:"AccountEditView",setup(O){const{$gettext:r}=D();return(N,I)=>(s(),p(T,null,[a(ue,{flat:""},{default:e(()=>[a(re,null,{default:e(()=>[c(o(n(r)("Edit account")),1)]),_:1})]),_:1}),a(Fe)],64))}},We=X(he,[["__scopeId","data-v-4019c7f8"]]);export{We as default};
