{% extends "coderedcms/blocks/base_block.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% block block_render %}
{% load static %}

<script src="https://kit.fontawesome.com/2e8803d931.js" crossorigin="anonymous"></script>
<section class="section-curso-cards">
    <div class="wrapper-text-cursos">
        <h2 class="h2-cursos">Cursos</h2>
        <h4 class="h4-desc">São mais de 750 cursos de alto desempenho para a formação de habilidades nas várias áreas de conhecimento.</h4>
    </div>

    <div class="wrapper-carousel-container01">
        <div class="carousel-container01">
            <div class="carousel-items01" id="cursos-carousel">
                {% for course in pages %}
                <div class="carousel-item-wrapper">
                    <div class="carousel-item-curso">
                        <div class="image-curso">
                            {% if course.cover_image %}
                            {% image course.cover_image fill-236x140 format-webp preserve-svg as card_img %}
                            <a href="{% pageurl course %}" title="{{ course.title }}">
                                <img class="img-fluid" src="{{ card_img.url }}" alt="{{ card_img.title }}">
                            </a>
                            {% endif %}
                        </div>
                        <div class="content-curso">
                            <div class="tag">Aberto</div>
                            <a class="h3-card" href="{% pageurl course %}">{{ course.title }}</a>
                            <p class="card-text">{{ course.body_preview|truncatewords:10 }}</p>
                            <p><a href="{% pageurl course %}" class="btn btn-primary">Leia mais <i class="fa-solid fa-circle-chevron-right"></i></a></p>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="carousel-item-wrapper">
                    <p>Nenhum conteúdo disponível.</p>
                </div>
                {% endfor %}
            </div>
            
            <button class="carousel-control-curso carousel-control-curso-prev"><img src="{% static 'enap_designsystem/icons/iconleft.svg' %}" alt="Passar pro lado esquerdo"></button>
            <button class="carousel-control-curso carousel-control-curso-next"><img src="{% static 'enap_designsystem/icons/iconrig.svg' %}" alt="Passar pro lado direito"></button>
        </div>
    </div>

    <div class="text-center mt-4">
        <a class="btn-todos" href="{% pageurl value.indexed_by %}" class="btn-todos">Ver todos os cursos</a>
    </div>
</section>

<style>
    .btn-todos{
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #007D7A;
        border: 1px solid #007D7A;
        padding: 8px 24px;
        border-radius: 40px;
        background-color: white;
        font-weight: 600;
    }
    .btn-todos:hover{
        color: #006969;
        border: 1px solid #006969;
    }

    .btn-todos:active{
        color: #025257;
        border: 1px solid #025257;
    }
    .section-curso-cards {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3rem;
        text-align: center;
        margin: auto;
        padding: 60px 15px;
    }
    .tag{
        width: 68px;
        height: 20px;
        border: 1px solid #024248;
        font-size: 14px;
        font-weight: 400;
        color: #024248;
        border-radius: 24px;
    }
    .h2-cursos{
        font-size: 40px;
        color: #434A54;
        text-align: center;
        margin: 0;
        font-weight: 600;
    }

    .h3-card{
        font-size: 18px;
        color: #434A54;
        text-decoration: none;
        font-weight: 600;
        margin: 0;
    }

    .h4-desc{
        font-size: 18px;
        color: #434A54;
        font-weight: 400;
        text-align: center;
        margin: 10px 0 0 0;
    }

    .wrapper-carousel-container01{
        overflow-x: hidden;
        width: 74.1rem;
        margin: auto;
        position: relative;
        touch-action: pan-y;
    }

    .carousel-container01 {
        position: relative;
        width: 1142px;
        margin: auto;
    }
    
    .carousel-items01 {
        display: flex;
        transition: transform 0.3s ease-in-out;
        gap: 25px;
        cursor: grab;
        width: calc(100% + 25px); /* Compensa o gap */
        margin-right: -25px
    }
    
    .carousel-items01:active {
        cursor: grabbing;
    }
    
    .carousel-item-wrapper {
        flex-shrink: 0;
        width: 268px;
        margin-right: 0; /* Remove qualquer margem extra */
    }
    
    .carousel-item-curso {
        display: flex;
        flex-direction: column;
        padding: 16px;
        border: 1px solid #C8D1E0;
        border-radius: 20px;
        gap: 16px;
    }
    
    .image-curso {
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
    }
    
    .content-curso {
        display: flex;
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
        width: 100%;
    }
    
    .carousel-control-curso {
        position: absolute;
        border: none;
        background-color: transparent;
        top: 50%;
        transform: translateY(-50%);
        font-size: 30px;
        cursor: pointer;
        z-index: 10;
    }
    
    .carousel-control-curso-prev {
        left: -30px;
    }
    
    .carousel-control-curso-next {
        right: -30px;
    }
    
    .btn {
        border: none;
        border-radius: 32px;
        color: #007D7A;
        text-decoration: none;
    }
    
    /* Estilos responsivos */
    @media (max-width: 768px) {
        .section-curso {
            padding: 40px 0 40px 16px;
        }
        
        .h2-cursos {
            font-size: 32px;
            text-align: left;
        }

        .wrapper-text-cursos{
            width: 70%;
        }
        
        .h4-desc {
            font-size: 20px;
            text-align: left;
        }
        
        .carousel-item-wrapper {
            width: 85vw;
            max-width: 268px;
        }
        
        .carousel-control-curso {
            display: none;
        }

        .carousel-container01 {
            margin: 0;
        }
    }
    
    @media (max-width: 480px) {
        .carousel-item-wrapper {
            width: 90vw;
            max-width: 268px;
        }
        
        
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('cursos-carousel');
        const carouselControls = document.querySelectorAll('.carousel-control-curso');
        const items = carousel.querySelectorAll('.carousel-item-wrapper');
        const itemWidth = items[0].offsetWidth;
        const itemsGap = 25;
        
        let currentIndex = 0;
        let startX, moveX, initialPosition;
        let isDragging = false;
        
        // Variáveis para calcular visibilidade e total de slides
        const totalItems = items.length;
        const containerWidth = carousel.parentElement.offsetWidth;
        const maxIndex = Math.max(0, totalItems - Math.floor(containerWidth / (itemWidth + itemsGap)));
        
        // Função para exibir o slide
        function showSlide(index) {
            currentIndex = Math.max(0, Math.min(index, maxIndex));
            const offset = currentIndex * (itemWidth + itemsGap);
            carousel.style.transform = `translateX(-${offset}px)`;
        }
        
        // Controles de seta (apenas visíveis no desktop)
        carouselControls.forEach((control, index) => {
            control.addEventListener('click', () => {
                if (index === 0) {
                    showSlide(currentIndex - 4);
                } else {
                    showSlide(currentIndex + 4);
                }
            });
        });
        
        // Touch e arraste para mobile
        carousel.addEventListener('touchstart', handleStart, { passive: true });
        carousel.addEventListener('touchmove', handleMove, { passive: true });
        carousel.addEventListener('touchend', handleEnd, { passive: true });
        
        // Mouse para desktop (como fallback)
        carousel.addEventListener('mousedown', handleStart);
        carousel.addEventListener('mousemove', handleMove);
        carousel.addEventListener('mouseup', handleEnd);
        carousel.addEventListener('mouseleave', handleEnd);
        
        function handleStart(e) {
            isDragging = true;
            startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            initialPosition = currentIndex * (itemWidth + itemsGap);
            
            // Desativar transição durante o arrasto para melhor responsividade
            carousel.style.transition = 'none';
        }
        
        function handleMove(e) {
            if (!isDragging) return;
            
            moveX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const diff = moveX - startX;
            
            // Limitar o arrasto
            if (currentIndex === 0 && diff > 50) {
                carousel.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
            } else if (currentIndex === maxIndex && diff < -50) {
                carousel.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
            } else {
                carousel.style.transform = `translateX(${diff - initialPosition}px)`;
            }
        }
        
        function handleEnd() {
            if (!isDragging) return;
            isDragging = false;
            
            // Restaurar transição
            carousel.style.transition = 'transform 0.3s ease-in-out';
            
            const diff = moveX - startX;
            if (diff > 50) {
                showSlide(currentIndex - 1);
            } else if (diff < -50) {
                showSlide(currentIndex + 1);
            } else {
                showSlide(currentIndex);
            }
        }
        
        // Ajustar o carrossel quando a janela é redimensionada
        window.addEventListener('resize', function() {
            showSlide(currentIndex);
        });
    });
</script>
{% endblock %}