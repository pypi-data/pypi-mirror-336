"use strict";(self.webpackChunkjupyter_pencil=self.webpackChunkjupyter_pencil||[]).push([[885],{56:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function i(e){for(var i=-1,s=0;s<t.length;s++)if(t[s].identifier===e){i=s;break}return i}function s(e,s){for(var a={},o=[],r=0;r<e.length;r++){var l=e[r],c=s.base?l[0]+s.base:l[0],h=a[c]||0,d="".concat(c," ").concat(h);a[c]=h+1;var u=i(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(p);else{var m=n(p,s);s.byIndex=r,t.splice(r,0,{identifier:d,updater:m,references:1})}o.push(d)}return o}function n(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,n){var a=s(e=e||[],n=n||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var r=i(a[o]);t[r].references--}for(var l=s(e,n),c=0;c<a.length;c++){var h=i(a[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}a=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",s=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),s&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),s&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,s,n,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(s)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);s&&o[h[0]]||(void 0!==a&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),n&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=n):h[4]="".concat(n)),t.push(h))}},t}},330:e=>{e.exports=JSON.parse('{"name":"jupyter-pencil","version":"0.1.1","description":"A Jupyter widget for drawing and capturing hand-drawn numbers and letters optimized for machine learning tasks.","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/dotnetautor/ipypencil","bugs":{"url":"https://github.com/dotnetautor/ipypencil/issues"},"license":"BSD-3-Clause","author":{"name":"Matthias Fischer","email":"opensource@dotnetautor.de"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/dotnetautor/ipypencil"},"scripts":{"build":"jlpm run build:lib && jlpm run build:nbextension && jlpm run build:labextension:dev","build:prod":"jlpm run build:lib && jlpm run build:nbextension && jlpm run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"jlpm run clean:lib && jlpm run clean:nbextension && jlpm run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ipypencil/labextension","clean:nbextension":"rimraf ipypencil/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"jlpm run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2 || ^3 || ^4 || ^5 || ^6"},"devDependencies":{"@babel/core":"^7.23.7","@babel/preset-env":"^7.23.8","@jupyter-widgets/base-manager":"^1.0.7","@jupyterlab/builder":"^4.0.11","@lumino/application":"^2.3.0","@lumino/widgets":"^2.3.1","@types/jest":"^29.5.11","@types/webpack-env":"^1.18.4","@typescript-eslint/eslint-plugin":"^6.19.1","@typescript-eslint/parser":"^6.19.1","acorn":"^8.11.3","css-loader":"^6.9.1","eslint":"^8.56.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","fs-extra":"^11.2.0","identity-obj-proxy":"^3.0.0","jest":"^29.7.0","jest-canvas-mock":"^2.5.2","jest-environment-jsdom":"^29.7.0","mkdirp":"^3.0.1","npm-run-all":"^4.1.5","prettier":"^3.2.4","rimraf":"^5.0.5","source-map-loader":"^5.0.0","style-loader":"^3.3.4","ts-jest":"^29.1.2","ts-loader":"^9.5.1","typescript":"~5.3.3","webpack":"^5.90.0","webpack-cli":"^5.1.4"},"devDependenciesComments":{"@jupyterlab/builder":"pinned to the latest JupyterLab 3.x release","@lumino/application":"pinned to the latest Lumino 1.x release","@lumino/widgets":"pinned to the latest Lumino 1.x release"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ipypencil/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')},463:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var s=i(72),n=i.n(s),a=i(825),o=i.n(a),r=i(659),l=i.n(r),c=i(56),h=i.n(c),d=i(540),u=i.n(d),p=i(113),m=i.n(p),v=i(930),g={};g.styleTagTransform=m(),g.setAttributes=h(),g.insert=l().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=u(),n()(v.A,g);const f=v.A&&v.A.locals?v.A.locals:void 0},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,i){var s=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},797:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const s=i(330);t.MODULE_VERSION=s.version,t.MODULE_NAME=s.name},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var a=i.sourceMap;a&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},885:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasView=t.CanvasModel=void 0;const s=i(983),n=i(797);i(463);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.model_name,_model_module:a.model_module,_model_module_version:a.model_module_version,_view_name:a.view_name,_view_module:a.view_module,_view_module_version:a.view_module_version,width:28,height:28,zoom:8,base64_data:""})}}t.CanvasModel=a,a.serializers=Object.assign(Object.assign({},s.DOMWidgetModel.serializers),{image_data:{deserialize:e=>new Uint8Array(e.buffer)}}),a.model_name="CanvasModel",a.model_module=n.MODULE_NAME,a.model_module_version=n.MODULE_VERSION,a.view_name="CanvasView",a.view_module=n.MODULE_NAME,a.view_module_version=n.MODULE_VERSION;class o extends s.DOMWidgetView{constructor(){super(...arguments),this.isDrawing=!1,this.color="#fff",this.lastPos={x:0,y:0}}render(){this.el.classList.add("ipypencil-canvas-widget"),this.canvasWrapper=document.createElement("div"),this.canvasWrapper.style.position="relative",this.el.appendChild(this.canvasWrapper),this.canvas=document.createElement("canvas"),this.canvas.width=this.model.get("width"),this.canvas.height=this.model.get("height"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.updateCanvasZoom(),this.canvasWrapper.appendChild(this.canvas),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.setupEventListeners(),this.model.on("change:width",this.updateCanvasSize,this),this.model.on("change:height",this.updateCanvasSize,this),this.model.on("change:zoom",this.updateCanvasZoom,this),this.model.on("msg:custom",this.onCustomMessage,this),this.updateGrid(),this.updateImageData()}updateCanvasSize(){this.canvas.width=this.model.get("width"),this.canvas.height=this.model.get("height"),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="black",this.updateCanvasZoom(),this.updateGrid(),this.updateImageData()}updateCanvasZoom(){const e=this.model.get("zoom"),t=this.model.get("width"),i=this.model.get("height");this.canvas.style.width=t*e+"px",this.canvas.style.height=i*e+"px",this.canvas.style.imageRendering="pixelated",this.canvasWrapper.style.width=t*e+"px",this.canvasWrapper.style.height=i*e+"px",this.updateGrid()}updateGrid(){const e=this.canvasWrapper.querySelector(".ipypencil-grid");e&&this.canvasWrapper.removeChild(e);const t=this.model.get("zoom");if(t>=4){const e=document.createElement("canvas");e.className="ipypencil-grid",e.width=this.model.get("width")*t,e.height=this.model.get("height")*t,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.pointerEvents="none";const i=e.getContext("2d"),s=this.model.get("width"),n=this.model.get("height");i.strokeStyle="rgba(0, 0, 0, 0.1)",i.lineWidth=1;for(let e=0;e<=s;e++)i.beginPath(),i.moveTo(e*t,0),i.lineTo(e*t,n*t),i.stroke();for(let e=0;e<=n;e++)i.beginPath(),i.moveTo(0,e*t),i.lineTo(s*t,e*t),i.stroke();this.canvasWrapper.appendChild(e)}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.onMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.onTouchEnd.bind(this))}onMouseDown(e){e.preventDefault(),e.stopPropagation(),this.isDrawing=!0,this.color=1===e.button?"#000":"#fff",this.lastPos=this.getMousePosition(e)}onMouseMove(e){if(!this.isDrawing)return;const t=this.getMousePosition(e);this.draw(t.x,t.y,this.color),this.lastPos=t}onMouseUp(){this.isDrawing&&(this.isDrawing=!1,this.updateImageData())}onTouchStart(e){if(1===e.touches.length){e.preventDefault(),this.isDrawing=!0,this.color="#fff";const t=e.touches[0];this.lastPos=this.getTouchPosition(t)}}onTouchMove(e){if(!this.isDrawing||1!==e.touches.length)return;e.preventDefault();const t=e.touches[0],i=this.getTouchPosition(t);this.draw(i.x,i.y,this.color),this.lastPos=i}onTouchEnd(e){this.isDrawing=!1,this.updateImageData()}getMousePosition(e){const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,s=this.canvas.height/t.height;return{x:Math.floor((e.clientX-t.left)*i),y:Math.floor((e.clientY-t.top)*s)}}getTouchPosition(e){const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,s=this.canvas.height/t.height;return{x:Math.floor((e.clientX-t.left)*i),y:Math.floor((e.clientY-t.top)*s)}}draw(e,t,i="#fff"){this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.strokeStyle=i,this.ctx.moveTo(this.lastPos.x,this.lastPos.y),this.ctx.lineTo(e,t),this.ctx.stroke()}updateImageData(){const e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=[];for(let i=0;i<e.data.length;i+=4){const s=e.data[i],n=e.data[i+1],a=e.data[i+2],o=Math.round(.299*s+.587*n+.114*a);t.push(o)}const i=new ArrayBuffer(t.length),s=new Uint8Array(i);s.set(t);const n=btoa(String.fromCharCode(...s));this.model.set("base64_data",n,{updated_view:this}),this.model.save_changes()}onCustomMessage(e){"clear"===e.action?this.clear():"update_image_data"===e.action&&this.updateImageData()}clear(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.updateImageData()}}t.CanvasView=o},930:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(601),n=i.n(s),a=i(314),o=i.n(a)()(n());o.push([e.id,".ipypencil-canvas-widget {\n  position: relative;\n}\n",""]);const r=o}}]);