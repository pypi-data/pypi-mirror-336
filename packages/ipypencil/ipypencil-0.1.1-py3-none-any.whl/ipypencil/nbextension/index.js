define(["@jupyter-widgets/base"],(e=>(()=>{"use strict";var t={55:t=>{t.exports=e},56:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var a={},o=[],r=0;r<e.length;r++){var l=e[r],c=n.base?l[0]+n.base:l[0],d=a[c]||0,h="".concat(c," ").concat(d);a[c]=d+1;var u=i(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(p);else{var v=s(p,n);n.byIndex=r,t.splice(r,0,{identifier:h,updater:v,references:1})}o.push(h)}return o}function s(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,s){var a=n(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var r=i(a[o]);t[r].references--}for(var l=n(e,s),c=0;c<a.length;c++){var d=i(a[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=l}}},110:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasView=t.CanvasModel=void 0;const n=i(55),s=i(672);i(463);class a extends n.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.model_name,_model_module:a.model_module,_model_module_version:a.model_module_version,_view_name:a.view_name,_view_module:a.view_module,_view_module_version:a.view_module_version,width:28,height:28,zoom:8,base64_data:""})}}t.CanvasModel=a,a.serializers=Object.assign(Object.assign({},n.DOMWidgetModel.serializers),{image_data:{deserialize:e=>new Uint8Array(e.buffer)}}),a.model_name="CanvasModel",a.model_module=s.MODULE_NAME,a.model_module_version=s.MODULE_VERSION,a.view_name="CanvasView",a.view_module=s.MODULE_NAME,a.view_module_version=s.MODULE_VERSION;class o extends n.DOMWidgetView{constructor(){super(...arguments),this.isDrawing=!1,this.color="#fff",this.lastPos={x:0,y:0}}render(){this.el.classList.add("ipypencil-canvas-widget"),this.canvasWrapper=document.createElement("div"),this.canvasWrapper.style.position="relative",this.el.appendChild(this.canvasWrapper),this.canvas=document.createElement("canvas"),this.canvas.width=this.model.get("width"),this.canvas.height=this.model.get("height"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.updateCanvasZoom(),this.canvasWrapper.appendChild(this.canvas),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.setupEventListeners(),this.model.on("change:width",this.updateCanvasSize,this),this.model.on("change:height",this.updateCanvasSize,this),this.model.on("change:zoom",this.updateCanvasZoom,this),this.model.on("msg:custom",this.onCustomMessage,this),this.updateGrid(),this.updateImageData()}updateCanvasSize(){this.canvas.width=this.model.get("width"),this.canvas.height=this.model.get("height"),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="black",this.updateCanvasZoom(),this.updateGrid(),this.updateImageData()}updateCanvasZoom(){const e=this.model.get("zoom"),t=this.model.get("width"),i=this.model.get("height");this.canvas.style.width=t*e+"px",this.canvas.style.height=i*e+"px",this.canvas.style.imageRendering="pixelated",this.canvasWrapper.style.width=t*e+"px",this.canvasWrapper.style.height=i*e+"px",this.updateGrid()}updateGrid(){const e=this.canvasWrapper.querySelector(".ipypencil-grid");e&&this.canvasWrapper.removeChild(e);const t=this.model.get("zoom");if(t>=4){const e=document.createElement("canvas");e.className="ipypencil-grid",e.width=this.model.get("width")*t,e.height=this.model.get("height")*t,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.pointerEvents="none";const i=e.getContext("2d"),n=this.model.get("width"),s=this.model.get("height");i.strokeStyle="rgba(0, 0, 0, 0.1)",i.lineWidth=1;for(let e=0;e<=n;e++)i.beginPath(),i.moveTo(e*t,0),i.lineTo(e*t,s*t),i.stroke();for(let e=0;e<=s;e++)i.beginPath(),i.moveTo(0,e*t),i.lineTo(n*t,e*t),i.stroke();this.canvasWrapper.appendChild(e)}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.onMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.onTouchEnd.bind(this))}onMouseDown(e){e.preventDefault(),e.stopPropagation(),this.isDrawing=!0,this.color=1===e.button?"#000":"#fff",this.lastPos=this.getMousePosition(e)}onMouseMove(e){if(!this.isDrawing)return;const t=this.getMousePosition(e);this.draw(t.x,t.y,this.color),this.lastPos=t}onMouseUp(){this.isDrawing&&(this.isDrawing=!1,this.updateImageData())}onTouchStart(e){if(1===e.touches.length){e.preventDefault(),this.isDrawing=!0,this.color="#fff";const t=e.touches[0];this.lastPos=this.getTouchPosition(t)}}onTouchMove(e){if(!this.isDrawing||1!==e.touches.length)return;e.preventDefault();const t=e.touches[0],i=this.getTouchPosition(t);this.draw(i.x,i.y,this.color),this.lastPos=i}onTouchEnd(e){this.isDrawing=!1,this.updateImageData()}getMousePosition(e){const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,n=this.canvas.height/t.height;return{x:Math.floor((e.clientX-t.left)*i),y:Math.floor((e.clientY-t.top)*n)}}getTouchPosition(e){const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,n=this.canvas.height/t.height;return{x:Math.floor((e.clientX-t.left)*i),y:Math.floor((e.clientY-t.top)*n)}}draw(e,t,i="#fff"){this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.strokeStyle=i,this.ctx.moveTo(this.lastPos.x,this.lastPos.y),this.ctx.lineTo(e,t),this.ctx.stroke()}updateImageData(){const e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=[];for(let i=0;i<e.data.length;i+=4){const n=e.data[i],s=e.data[i+1],a=e.data[i+2],o=Math.round(.299*n+.587*s+.114*a);t.push(o)}const i=new ArrayBuffer(t.length),n=new Uint8Array(i);n.set(t);const s=btoa(String.fromCharCode(...n));this.model.set("base64_data",s,{updated_view:this}),this.model.save_changes()}onCustomMessage(e){"clear"===e.action?this.clear():"update_image_data"===e.action&&this.updateImageData()}clear(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.updateImageData()}}t.CanvasView=o},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},156:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(672),t),s(i(110),t)},265:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),window.__webpack_public_path__=document.querySelector("body").getAttribute("data-base-url")+"nbextensions/ipypencil",s(i(156),t)},330:e=>{e.exports=JSON.parse('{"name":"jupyter-pencil","version":"0.1.1","description":"A Jupyter widget for drawing and capturing hand-drawn numbers and letters optimized for machine learning tasks.","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/dotnetautor/ipypencil","bugs":{"url":"https://github.com/dotnetautor/ipypencil/issues"},"license":"BSD-3-Clause","author":{"name":"Matthias Fischer","email":"opensource@dotnetautor.de"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/dotnetautor/ipypencil"},"scripts":{"build":"jlpm run build:lib && jlpm run build:nbextension && jlpm run build:labextension:dev","build:prod":"jlpm run build:lib && jlpm run build:nbextension && jlpm run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"jlpm run clean:lib && jlpm run clean:nbextension && jlpm run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ipypencil/labextension","clean:nbextension":"rimraf ipypencil/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"jlpm run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2 || ^3 || ^4 || ^5 || ^6"},"devDependencies":{"@babel/core":"^7.23.7","@babel/preset-env":"^7.23.8","@jupyter-widgets/base-manager":"^1.0.7","@jupyterlab/builder":"^4.0.11","@lumino/application":"^2.3.0","@lumino/widgets":"^2.3.1","@types/jest":"^29.5.11","@types/webpack-env":"^1.18.4","@typescript-eslint/eslint-plugin":"^6.19.1","@typescript-eslint/parser":"^6.19.1","acorn":"^8.11.3","css-loader":"^6.9.1","eslint":"^8.56.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","fs-extra":"^11.2.0","identity-obj-proxy":"^3.0.0","jest":"^29.7.0","jest-canvas-mock":"^2.5.2","jest-environment-jsdom":"^29.7.0","mkdirp":"^3.0.1","npm-run-all":"^4.1.5","prettier":"^3.2.4","rimraf":"^5.0.5","source-map-loader":"^5.0.0","style-loader":"^3.3.4","ts-jest":"^29.1.2","ts-loader":"^9.5.1","typescript":"~5.3.3","webpack":"^5.90.0","webpack-cli":"^5.1.4"},"devDependenciesComments":{"@jupyterlab/builder":"pinned to the latest JupyterLab 3.x release","@lumino/application":"pinned to the latest Lumino 1.x release","@lumino/widgets":"pinned to the latest Lumino 1.x release"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ipypencil/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')},364:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);n&&o[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},463:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var n=i(72),s=i.n(n),a=i(825),o=i.n(a),r=i(659),l=i.n(r),c=i(56),d=i.n(c),h=i(540),u=i.n(h),p=i(113),v=i.n(p),m=i(930),g={};g.styleTagTransform=v(),g.setAttributes=d(),g.insert=l().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=u(),s()(m.A,g);const f=m.A&&m.A.locals?m.A.locals:void 0},516:e=>{e.exports=function(e){var t=e[1],i=e[3];if(!i)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),a="/*# ".concat(s," */");return[t].concat([a]).join("\n")}return[t].join("\n")}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},659:e=>{var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},672:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const n=i(330);t.MODULE_VERSION=n.version,t.MODULE_NAME=n.name},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var s=void 0!==i.layer;s&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,s&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var a=i.sourceMap;a&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},930:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(516),s=i.n(n),a=i(364),o=i.n(a)()(s());o.push([e.id,".ipypencil-canvas-widget {\n  position: relative;\n}\n","",{version:3,sources:["webpack://./css/widget.css"],names:[],mappings:"AAAA;EACE,kBAAkB;AACpB",sourcesContent:[".ipypencil-canvas-widget {\n  position: relative;\n}\n"],sourceRoot:""}]);const r=o}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var a=i[e]={id:e,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0,n(265)})()));
//# sourceMappingURL=index.js.map