"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9676],{59676:function(e,i,r){r.r(i),r.d(i,{default:function(){return j}});var t=r(24246),n=r(56351),s=r(16134),a=r(27378),l=r(812),o=r(14047),d=r(90867);let u=(0,n.Gpc)((e,i)=>{let{handleBlur:r,subjectRequest:u}=e,c=(0,s.T)(),[f,m]=(0,a.useState)(!1),{errorAlert:h,successAlert:x}=(0,o.V)(),{errorRequests:p}=(0,s.C)(d.fe),[g]=(0,d.JD)(),[j]=(0,d.Fq)(),y=async()=>{m(!0);let e=await g(p);"error"in e?(c((0,d.uT)({checkAll:!1,errorRequests:[]})),h((0,l.e$)(e.error),"DSR batch automation has failed due to the following:",{duration:null})):(e.data.failed.length>0&&h((0,t.jsxs)(n.xuv,{children:["DSR automation has failed for"," ",(0,t.jsx)(n.xvT,{as:"span",fontWeight:"semibold",children:e.data.failed.length})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null}),e.data.succeeded.length>0&&x("Privacy request(s) are now being reprocessed.")),m(!1)},v=async()=>{if(!u)return;m(!0);let e=await j(u);"error"in e?h((0,l.e$)(e.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):x("Privacy request is now being reprocessed."),m(!1),r&&r(i)};return(0,t.jsx)(n.wpx,{disabled:f,loading:f,onClick:u?v:y,ref:i,size:"small",icon:(0,t.jsx)(n.AyE,{}),children:"Reprocess"})});var c=r(34090),f=r(59389);let m=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,h=e=>m.test(e),x=(0,n.Gpc)((e,i)=>{let{isRequired:r=!1,...s}=e,{emails:l}=s.form.values,[o,d]=(0,a.useState)(""),u=e=>l.includes(e),c=e=>{e.map(e=>e.trim()).filter(e=>h(e)&&!u(e)).forEach(e=>s.push(e)),d("")};return(0,t.jsxs)(n.NIc,{alignItems:"baseline",display:"inline-flex",isInvalid:!!s.form.errors[s.name],isRequired:r,children:[(0,t.jsx)(n.lXp,{fontSize:"md",htmlFor:"email",children:"Email"}),(0,t.jsxs)(n.gCW,{align:"flex-start",w:"inherit",children:[(0,t.jsx)(n.IIB,{autoComplete:"off",placeholder:"Type or paste email addresses separated by commas and press `Enter` or `Tab`...",onChange:e=>{d(e.target.value)},onKeyDown:e=>{["Enter","Tab",","].includes(e.key)&&(e.preventDefault(),c([o]))},onPaste:e=>{e.preventDefault(),c(e.clipboardData.getData("text").split(","))},ref:i,size:"sm",type:"email",value:o}),(0,t.jsx)(n.J1D,{children:s.form.errors[s.name]}),l.length>0&&(0,t.jsx)(n.Eq9,{spacing:1,mb:3,pt:"8px",children:l.map((e,i)=>(0,t.jsxs)(n.Vp9,{borderRadius:"full",backgroundColor:"primary.400",color:"white",size:"sm",variant:"solid",children:[(0,t.jsx)(n.Sn0,{children:e}),(0,t.jsx)(n.SD9,{onClick:()=>{s.remove(i)}})]},e))})]})]})}),p=f.Ry().shape({emails:f.IX(f.Z_()).when(["notify"],{is:!0,then:()=>f.IX(f.Z_()).min(1,"Must enter at least one valid email").label("Email")}),notify:f.O7(),minErrorCount:f.Rx().required()});var g=()=>{let{isOpen:e,onOpen:i,onClose:r}=(0,n.qY0)(),[s,u]=(0,a.useState)({emails:[],notify:!1,minErrorCount:1}),f=(0,a.useRef)(null),{errorAlert:m,successAlert:h}=(0,o.V)(),[g,j]=(0,a.useState)(!0),{data:y}=(0,d.tE)(void 0,{skip:g}),[v]=(0,d.SC)(),C=async(e,i)=>{i.setSubmitting(!0);let t=await v({email_addresses:e.emails,notify_after_failures:e.notify?e.minErrorCount:0});"error"in t?m((0,l.e$)(t.error),"Configure alerts and notifications has failed to save due to the following:"):h("Configure alerts and notifications saved successfully."),i.setSubmitting(!1),r()};return(0,a.useEffect)(()=>{e&&j(!1),y&&u({emails:y.email_addresses,notify:0!==y.notify_after_failures,minErrorCount:y.notify_after_failures})},[y,e]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.wpx,{onClick:i,title:"Configure alerts","aria-label":"Configure alerts",icon:(0,t.jsx)(n.Dkj,{})}),(0,t.jsx)(c.J9,{enableReinitialize:!0,initialValues:s,onSubmit:C,validationSchema:p,children:i=>(0,t.jsxs)(n.dys,{isOpen:e,placement:"right",initialFocusRef:f,onClose:()=>{i.resetForm(),r()},size:"lg",children:[(0,t.jsx)(n.P1B,{}),(0,t.jsxs)(n.scA,{color:"gray.900",children:[(0,t.jsx)(n.cCv,{}),(0,t.jsxs)(n.OXI,{color:"gray.900",children:[(0,t.jsx)(n.xvT,{fontSize:"2xl",fontWeight:"normal",mb:4,children:"Configure alerts and notifications"}),(0,t.jsx)(n.xuv,{mt:"26px",children:(0,t.jsx)(n.xvT,{fontSize:"md",fontWeight:"normal",children:"Setup your alerts to send you a notification when there are any processing failures. You can also setup a threshold for connector failures for Fides to notify you after X amount of failures have occurred."})})]}),(0,t.jsx)(n.Ng0,{mt:"20px",children:(0,t.jsxs)(c.l0,{id:"configure-alerts-form",noValidate:!0,children:[(0,t.jsx)(n.xvT,{fontSize:"md",children:"Contact details"}),(0,t.jsxs)(n.gCW,{align:"stretch",gap:"29px",mt:"14px",children:[(0,t.jsx)(n.Ugi,{children:(0,t.jsx)(c.F2,{name:"emails",render:e=>(0,t.jsx)(x,{...e,isRequired:i.values.notify,ref:f})})}),(0,t.jsx)(n.Ugi,{children:(0,t.jsx)(c.gN,{id:"notify",name:"notify",children:e=>{let{field:r}=e;return(0,t.jsxs)(n.NIc,{alignItems:"center",display:"flex",mt:"45px",children:[(0,t.jsx)(n.lXp,{fontSize:"md",mb:"0",children:"Notify me immediately if there are any DSR processing errors"}),(0,t.jsx)(n.rAg,{checked:i.values.notify,onChange:(e,t)=>{r.onChange(t),i.setFieldValue(r.name,e),i.setFieldValue("minErrorCount",1),e||setTimeout(()=>{i.setFieldTouched("emails",!1)},0)}})]})}})})]}),(0,t.jsx)(n.xvT,{color:"#757575",fontSize:"sm",mt:"11px",children:"If selected, then Fides will notify you by your chosen method of communication every time the system encounters a data subject request processing error. You can turn this off anytime and setup a more suitable notification method below if you wish."}),i.values.notify&&(0,t.jsx)(n.Ugi,{mt:"34px",children:(0,t.jsx)(c.gN,{id:"minErrorCount",name:"minErrorCount",children:e=>{let{field:r,meta:s}=e;return(0,t.jsxs)(n.NIc,{alignItems:"center",display:"flex",isInvalid:!!(s.error&&s.touched),isRequired:!0,children:[(0,t.jsx)(n.xvT,{children:"Notify me after"}),(0,t.jsxs)(n.Y2U,{allowMouseWheel:!0,color:"gray.700",defaultValue:i.values.minErrorCount||1,min:1,ml:"8px",mr:"8px",onChange:(e,r)=>{i.setFieldValue("minErrorCount",r)},size:"sm",w:"80px",children:[(0,t.jsx)(n.zuI,{...r}),(0,t.jsxs)(n.FiK,{children:[(0,t.jsx)(n.WQu,{}),(0,t.jsx)(n.Y_d,{})]})]}),(0,t.jsx)(n.xvT,{children:"DSR processing errors "})]})}})})]})}),(0,t.jsx)(n.zeN,{justifyContent:"flex-start",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.wpx,{onClick:()=>{i.resetForm(),r()},children:"Cancel"}),(0,t.jsx)(n.wpx,{form:"configure-alerts-form",disabled:i.isSubmitting,loading:i.isSubmitting,htmlType:"submit",children:"Save"})]})})]})]})})]})},j=()=>{let{errorRequests:e}=(0,s.C)(d.fe);return(0,t.jsxs)(n.kCb,{gap:4,children:[(null==e?void 0:e.length)>0&&(0,t.jsx)(u,{}),(0,t.jsx)(g,{})]})}}}]);