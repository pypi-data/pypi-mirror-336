"use strict";(self.webpackChunkmcp_client_jupyter_chat=self.webpackChunkmcp_client_jupyter_chat||[]).push([[70],{70:(n,t,e)=>{e.r(t),e.d(t,{default:()=>A});var o=e(72),a=e.n(o),r=e(825),s=e.n(r),i=e(659),c=e.n(i),l=e(56),d=e.n(l),p=e(540),u=e.n(p),h=e(113),m=e.n(h),g=e(646),v={};v.styleTagTransform=m(),v.setAttributes=d(),v.insert=c().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=u(),a()(g.A,v),g.A&&g.A.locals&&g.A.locals;var x=e(120),f=e(256),y=e(178),b=e(693),k=e(158),w=e(796),C=e(752),_=e(88),E=e(910),j=e(32),L=e.n(j);class M{getServerTools(n){return this.tools.get(n)||[]}constructor(n,t,e,o){this.SERVER_TOOL_SEPARATOR="__",this.chats=new Map,this.chatTokenUsage=new Map,this.currentChatId=null,this.tools=new Map,this.stateKey="mcp-chat:conversation-history",this.mcpClients=n,this.anthropic=new(L())({apiKey:e,dangerouslyAllowBrowser:!0}),this.modelName=t,this.stateDB=o,this.loadHistory()}generateChatId(){return`chat-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateChatTitle(n){if(0===n.length)return"New Chat";const t=n[0];if("string"==typeof t.content){const n=t.content.slice(0,30);return n.length<t.content.length?`${n}...`:n}return"New Chat"}async initializeTools(){try{this.tools.clear();for(const[n,t]of this.mcpClients)try{const e=await t.listTools();e&&Array.isArray(e.tools)&&this.tools.set(n,e.tools),console.log(`Initialized ${e.tools.length} tools from ${n}`)}catch(t){console.error(`Failed to initialize tools from ${n}:`,t)}if(0===this.tools.size)throw new Error("No tools available from any MCP server")}catch(n){throw console.error("Failed to initialize tools:",n),n}}getChats(){return Array.from(this.chats.entries()).map((([n,t])=>({id:n,title:this.generateChatTitle(t),createdAt:n.split("-")[1]}))).sort(((n,t)=>parseInt(t.createdAt)-parseInt(n.createdAt)))}getCurrentChat(){return this.currentChatId&&this.chats.get(this.currentChatId)||[]}getCurrentChatTokenUsage(){return this.currentChatId&&this.chatTokenUsage.get(this.currentChatId)||{input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0}}createNewChat(){const n=this.generateChatId();return this.chats.set(n,[]),this.chatTokenUsage.set(n,{input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0}),this.currentChatId=n,this.saveHistory(),n}loadChat(n){return!!this.chats.has(n)&&(this.currentChatId=n,this.saveHistory(),!0)}deleteCurrentChat(){if(this.currentChatId){this.chats.delete(this.currentChatId);const n=Array.from(this.chats.keys());n.length>0?this.currentChatId=n[n.length-1]:this.createNewChat(),this.saveHistory()}}async*sendMessage(n,t){var e,o,a,r;this.currentChatId||this.createNewChat();const s=this.getCurrentChat();if(n){let e=n;null!==t.notebookPath&&(e+=`\n Current Notebook Path: ${t.notebookPath}`),null!==t.activeCellID&&(e+=`\n Active selected cell ID: ${t.activeCellID}`),s.push({role:"user",content:e}),await this.saveHistory()}let i=!0;try{for(;i;){let n="",t="",c="",l="";i=!1;const d=Array.from(this.tools.entries()).flatMap((([n,t])=>t.map((t=>({name:`${n}${this.SERVER_TOOL_SEPARATOR}${t.name}`,description:t.description,input_schema:t.inputSchema})))));d[d.length-1].cache_control={type:"ephemeral"};const p=[...s];if(p.length>0){const n=p.length-1,t=p[n];if("string"==typeof t.content){const e=t.content;p[n]={...t,content:[{type:"text",text:e,cache_control:{type:"ephemeral"}}]}}}const u=this.anthropic.messages.stream({model:this.modelName,max_tokens:4096,messages:p,tools:d,system:"Before answering, explain your reasoning step-by-step."});for await(const e of u)if("content_block_start"===e.type)"tool_use"===e.content_block.type&&(c=e.content_block.name,l=e.content_block.id);else if("content_block_delta"===e.type)"text_delta"===e.delta.type?(n+=e.delta.text,yield{type:"text",text:e.delta.text}):"input_json_delta"===e.delta.type&&(t+=e.delta.partial_json);else if("message_delta"===e.type)if("tool_use"===e.delta.stop_reason){if(i=!0,""!==c){const e=[];""!==n&&(e.push({type:"text",text:n}),n="");const o=JSON.parse(t),a={type:"tool_use",id:l,name:c,input:o};e.push(a),yield{type:"tool_use",name:c,input:o},s.push({role:"assistant",content:e}),await this.saveHistory();try{const[n,t]=c.split(this.SERVER_TOOL_SEPARATOR),e=this.mcpClients.get(n);if(!e)throw new Error(`MCP server ${n} not found`);const a=(await e.callTool({name:t,arguments:o,_meta:{}})).content.map((n=>"text"===n.type?{type:"text",text:n.text}:"image"===n.type?{type:"image",source:{type:"base64",media_type:n.mimeType,data:n.data}}:{type:"text",text:"Unsupported content type"})),r={type:"tool_result",tool_use_id:l,content:a};yield{type:"tool_result",name:c,content:JSON.stringify(a)},s.push({role:"user",content:[r]}),await this.saveHistory()}catch(n){console.error("Error executing tool:",n);const t={type:"text",text:`Error executing tool ${c}: ${n}`};yield t,i=!1}finally{c="",l="",t="",n=""}}}else if(""!==n){const e={type:"text",text:n};s.push({role:"assistant",content:[e]}),await this.saveHistory(),n="",t=""}const h=await u.finalMessage();if(console.log("Final message:",null===(e=h.usage)||void 0===e?void 0:e.cache_creation_input_tokens,null===(o=h.usage)||void 0===o?void 0:o.cache_read_input_tokens,null===(a=h.usage)||void 0===a?void 0:a.input_tokens,null===(r=h.usage)||void 0===r?void 0:r.output_tokens),this.currentChatId&&h.usage){const n=this.chatTokenUsage.get(this.currentChatId)||{input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0};this.chatTokenUsage.set(this.currentChatId,{input_tokens:n.input_tokens+(h.usage.input_tokens||0),output_tokens:n.output_tokens+(h.usage.output_tokens||0),cache_creation_input_tokens:n.cache_creation_input_tokens+(h.usage.cache_creation_input_tokens||0),cache_read_input_tokens:n.cache_read_input_tokens+(h.usage.cache_read_input_tokens||0)}),await this.saveHistory()}}}catch(n){console.error("Error processing message:",n),yield{type:"text",text:"An error occurred while processing your message."}}}async saveHistory(){const n=Array.from(this.chats.entries()).map((([n,t])=>({id:n,title:this.generateChatTitle(t),createdAt:n.split("-")[1],tokenUsage:this.chatTokenUsage.get(n)||{input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0},messages:t.map((n=>{const t=Array.isArray(n.content)?n.content.map((n=>"text"in n?{type:"text",text:n.text}:{type:n.type,...Object.entries(n).reduce(((n,[t,e])=>("string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e?n[t]=e:"object"==typeof e&&(n[t]=JSON.parse(JSON.stringify(e))),n)),{})})):n.content;return{role:n.role,content:t}}))}))),t={chats:JSON.parse(JSON.stringify(n)),currentChatId:this.currentChatId};await this.stateDB.save(this.stateKey,t)}async loadHistory(){const n=await this.stateDB.fetch(this.stateKey);if(n&&"object"==typeof n&&"chats"in n&&Array.isArray(n.chats)){const t={chats:n.chats,currentChatId:n.currentChatId};this.chats.clear(),t.chats.forEach((n=>{this.chats.set(n.id,n.messages.map((n=>{const t=Array.isArray(n.content)?n.content.map((n=>"text"===n.type?{type:"text",text:n.text}:n)):n.content;return{role:n.role,content:t}}))),n.tokenUsage?this.chatTokenUsage.set(n.id,n.tokenUsage):this.chatTokenUsage.set(n.id,{input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0})})),t.currentChatId&&this.chats.has(t.currentChatId)?this.currentChatId=t.currentChatId:this.chats.size>0?this.currentChatId=Array.from(this.chats.keys())[this.chats.size-1]:this.createNewChat()}else this.createNewChat()}}const z={id:"mcp-client-jupyter-chat:plugin",description:"A JupyterLab extension for Chat with AI supporting MCP",autoStart:!0,requires:[x.ICommandPalette,w.IStateDB,k.INotebookTracker,b.IRenderMimeRegistry],optional:[C.ISettingRegistry],activate:async(n,t,e,o,a,r)=>{console.log("JupyterLab extension mcp-client-jupyter-chat is activated!");let s=[],i=null,c=null;const l=new Map,d=document.createElement("div");d.classList.add("mcp-model-select");const p=document.createElement("select");if(p.addEventListener("change",(()=>{i=s.find((n=>n.name===p.value))||null})),r){const n=async n=>{var t;c=n.composite;const e=(null==c?void 0:c.models)||[];s=Array.isArray(e)?e:[],i=s.find((n=>n.isDefault))||s[0]||null,console.log("mcp-client-jupyter-chat settings loaded:",`models: ${s.length},`,`additional servers: ${(null===(t=null==c?void 0:c.mcpServers)||void 0===t?void 0:t.length)||0}`),p.innerHTML="",s.forEach((n=>{const t=document.createElement("option");t.value=n.name,t.textContent=n.name,"gpt-4"===n.name&&(t.textContent="GPT-4"),t.selected=n===i,p.appendChild(t)})),await N()};r.load(z.id).then((t=>{n(t),t.changed.connect(n)})).catch((n=>{console.error("Failed to load settings for mcp-client-jupyter-chat.",n)}))}const u=new f.Widget,h=document.createElement("div");h.classList.add("mcp-chat");const m=document.createElement("div");m.classList.add("mcp-chat-area");const g=()=>{H?(m.innerHTML="",k(),H.getCurrentChat().forEach((n=>{if("string"==typeof n.content)R(n.content,"user"===n.role);else{const t=n.content.map((n=>"text"in n?{type:"text",text:n.text}:"tool_use"===n.type?{type:"tool_use",name:n.name,input:n.input}:"tool_result"===n.type?{type:"tool_result",content:JSON.stringify(n.content)}:{type:"text",text:"Unsupported content type"}));R(t,"user"===n.role)}}))):console.warn("Cannot display chat: Assistant not initialized")},v=document.createElement("div");v.classList.add("mcp-toolbar");const x=document.createElement("div");x.classList.add("mcp-toolbar-button","mcp-token-usage-button"),x.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>\n      </svg>\n      Token Usage\n    ';const b=document.createElement("div");b.classList.add("mcp-token-usage-popup");const k=()=>{if(!H)return;const n=H.getCurrentChatTokenUsage(),t=n.input_tokens,e=n.output_tokens,o=n.cache_creation_input_tokens,a=n.cache_read_input_tokens,r=t>0?Math.round(a/t*100):0;b.innerHTML=`\n        <div class="mcp-token-usage-header">Token Usage</div>\n        <div class="mcp-token-usage-content">\n          <div class="mcp-token-usage-item">Input: ${t}</div>\n          <div class="mcp-token-usage-item">Output: ${e}</div>\n          <div class="mcp-token-usage-item">Cache Creation: ${o}</div>\n          <div class="mcp-token-usage-item">Cache Read: ${a}</div>\n          <div class="mcp-token-usage-item">Cache Usage: ${r}%</div>\n        </div>\n      `};x.addEventListener("click",(()=>{k(),b.classList.toggle("show")}));const w=document.createElement("button");w.classList.add("mcp-toolbar-button"),w.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M12 5v14M5 12h14"/>\n      </svg>\n      New Chat\n    ',w.addEventListener("click",(()=>{H&&(H.createNewChat(),g())}));const C=document.createElement("button");C.classList.add("mcp-toolbar-button"),C.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>\n      </svg>\n      History\n    ',C.addEventListener("click",(()=>{if(!H)return void console.warn("Cannot display chat list: Assistant not initialized");m.innerHTML="";const n=document.createElement("div");n.classList.add("mcp-chat-list"),H.getChats().forEach((t=>{const e=document.createElement("div");e.classList.add("mcp-chat-item");const o=document.createElement("div");o.classList.add("mcp-chat-title"),o.textContent=t.title;const a=document.createElement("div");a.classList.add("mcp-chat-date"),a.textContent=new Date(parseInt(t.createdAt)).toLocaleString(),e.appendChild(o),e.appendChild(a),e.addEventListener("click",(()=>{(null==H?void 0:H.loadChat(t.id))&&g()})),n.appendChild(e)})),m.appendChild(n)}));const j=document.createElement("div");j.classList.add("mcp-tools-button"),j.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>\n      </svg>\n    ';const L=document.createElement("div");L.classList.add("mcp-tools-popup"),j.addEventListener("click",(async()=>{if(!H)return void console.warn("Cannot list tools: Assistant not initialized");L.innerHTML="";const n=document.createElement("div");n.classList.add("mcp-servers-header"),n.textContent="Available MCP Tools",L.appendChild(n);const t=document.createElement("ul");t.classList.add("mcp-tools-list");let e=0;for(const[n]of l.entries())try{const o=H.getServerTools(n);o.length>0&&o.forEach((o=>{e++;const a=document.createElement("li");a.classList.add("mcp-tools-item");const r=document.createElement("div");r.innerHTML=`\n                ${o.name}\n                <div class="mcp-tools-server">Server: ${n}</div>\n              `,a.appendChild(r),t.appendChild(a)}))}catch(t){console.error(`Failed to list tools for server ${n}:`,t)}if(0===e){const n=document.createElement("div");n.classList.add("mcp-no-servers"),n.textContent="No MCP tools available",t.appendChild(n)}L.appendChild(t),L.classList.toggle("show")}));const A=document.createElement("div");A.classList.add("mcp-plug-icon"),A.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M18.36 5.64a9 9 0 11-12.73 0M12 2v10"/>\n      </svg>\n    ';const T=document.createElement("div");T.classList.add("mcp-servers-popup"),A.addEventListener("click",(()=>{T.innerHTML="";const n=document.createElement("div");n.classList.add("mcp-servers-header"),n.textContent="All connected MCP servers (use settings to add/remove)",T.appendChild(n);const t=document.createElement("ul");if(t.classList.add("mcp-servers-list"),l.size>0)l.forEach(((n,e)=>{const o=document.createElement("li");o.classList.add("mcp-server-item"),o.textContent=e,t.appendChild(o)}));else{const n=document.createElement("div");n.classList.add("mcp-no-servers"),n.textContent="No MCP servers connected",t.appendChild(n)}T.appendChild(t),T.classList.toggle("show")})),document.addEventListener("click",(n=>{j.contains(n.target)||L.contains(n.target)||L.classList.remove("show"),A.contains(n.target)||T.contains(n.target)||T.classList.remove("show"),x.contains(n.target)||b.contains(n.target)||b.classList.remove("show")})),v.appendChild(w),v.appendChild(C),v.appendChild(x),v.appendChild(b),v.appendChild(j),v.appendChild(L),v.appendChild(A),v.appendChild(T);const I=document.createElement("div");I.classList.add("mcp-input-area");const S=document.createElement("div");S.classList.add("mcp-input-wrapper");const P=document.createElement("textarea");P.placeholder="Message MCP v3!...",P.classList.add("mcp-input");let H=null,$=!1;const N=async()=>{var n;if(!$){$=!0;try{for(const t of l.values())try{await(null===(n=t.transport)||void 0===n?void 0:n.close())}catch(n){console.error("Error closing client transport:",n)}l.clear();const t=new _.K({name:"jupyter-mcp-client-default",version:"0.1.0"},{capabilities:{tools:{},resources:{}}}),o=new URL("http://localhost:3002/sse"),a=new E.A(o);await t.connect(a),l.set("default",t),console.log("Successfully connected to default MCP server");const r=(null==c?void 0:c.mcpServers)||[];for(const n of r){const t=new _.K({name:`jupyter-mcp-client-${n.name}`,version:"0.1.0"},{capabilities:{tools:{},resources:{}}}),e=new E.A(new URL(n.url));try{await t.connect(e),l.set(n.name,t),console.log(`Successfully connected to MCP server: ${n.name}`)}catch(t){console.error(`Failed to connect to MCP server ${n.name}:`,t)}}if(!l.get("default"))throw new Error("Default MCP server not connected");if(!i)throw new Error("No model selected");H=new M(l,i.name,i.apiKey,e),await H.initializeTools(),await new Promise((n=>setTimeout(n,100))),g()}catch(n){(n instanceof Error?n.message:String(n)).includes("CORS")&&console.warn("CORS error detected. The MCP server must be configured with these headers:\n  Access-Control-Allow-Origin: http://localhost:8888\n  Access-Control-Allow-Methods: GET\n  Access-Control-Allow-Headers: Accept, Origin\n"),l.clear(),H=null}finally{$=!1}}};N().then((()=>{H&&g()})).catch(console.error),P.addEventListener("input",(()=>{P.style.height="auto";const n=Math.min(P.scrollHeight,.3*window.innerHeight);P.style.height=n+"px"}));const O=document.createElement("button");O.classList.add("mcp-send-button");const R=(n,t)=>{const e=document.createElement("div");if(e.classList.add("mcp-message"),e.classList.add(t?"user":"assistant"),"string"==typeof n){const t=a.createRenderer("text/markdown");t.renderModel({data:{"text/markdown":n},trusted:!0,metadata:{},setData:()=>{}}),e.appendChild(t.node)}else n.forEach((n=>{const t=document.createElement("div");switch(n.type){case"text":{const e=a.createRenderer("text/markdown");e.renderModel({data:{"text/markdown":n.text||""},trusted:!0,metadata:{},setData:()=>{}}),t.appendChild(e.node);break}case"tool_use":t.textContent=`[Using tool: ${n.name}]`,t.classList.add("tool-use");break;case"tool_result":{t.classList.add("tool-result"),n.is_error&&t.classList.add("error");const e=document.createElement("div");e.classList.add("tool-result-header"),e.textContent="Tool Result";const o=document.createElement("button");o.classList.add("tool-result-toggle"),o.textContent="Expand",o.onclick=()=>{const n=t.classList.toggle("expanded");o.textContent=n?"Collapse":"Expand"},e.appendChild(o),t.appendChild(e);const a=document.createElement("div");a.textContent="string"==typeof n.content?n.content:JSON.stringify(n.content,null,2),t.appendChild(a);break}}e.appendChild(t)}));m.appendChild(e),m.scrollTop=m.scrollHeight},U=async n=>{var t,e,r;if(R(n,!0),H&&0!==l.size||(R("Not connected to any MCP servers. Attempting to connect...",!1),await N(),H&&0!==l.size))try{const s=document.createElement("div");s.classList.add("mcp-message","assistant"),m.appendChild(s);let i=null;const c=null===(t=o.currentWidget)||void 0===t?void 0:t.context.path,l=null===(r=null===(e=o.currentWidget)||void 0===e?void 0:e.content.activeCell)||void 0===r?void 0:r.model.id;for await(const t of H.sendMessage(n,{notebookPath:c,activeCellID:l})){let n=document.createElement("div");switch(t.type){case"text":{i||(i=document.createElement("div"),i.classList.add("mcp-message-markdown"),s.appendChild(i));const n=(i.getAttribute("data-text")||"")+(t.text||"");i.setAttribute("data-text",n);const e=a.createRenderer("text/markdown");e.renderModel({data:{"text/markdown":n},trusted:!0,metadata:{},setData:()=>{}}),i.innerHTML="",i.appendChild(e.node);break}case"tool_use":i=null,n=document.createElement("div"),n.classList.add("tool-use"),n.textContent=`[Using tool: ${t.name}]`,s.appendChild(n);break;case"tool_result":{i=null,n=document.createElement("div"),n.classList.add("tool-result"),t.is_error&&n.classList.add("error");const e=document.createElement("div");e.classList.add("tool-result-header"),e.textContent="Tool Result";const a=document.createElement("button");a.classList.add("tool-result-toggle"),a.textContent="Expand",a.onclick=()=>{const t=n.classList.toggle("expanded");a.textContent=t?"Collapse":"Expand"},e.appendChild(a),n.appendChild(e);const r=document.createElement("pre");r.style.margin="0",r.style.whiteSpace="pre-wrap",r.textContent="string"==typeof t.content?t.content:JSON.stringify(t.content,null,2),n.appendChild(r),s.appendChild(n),o.currentWidget&&await o.currentWidget.context.revert();break}}m.scrollTop=m.scrollHeight}k(),b.classList.contains("show")||(b.classList.add("show"),setTimeout((()=>{b.classList.remove("show")}),4e3))}catch(n){console.error("Error handling message:",n),l.clear(),H=null,R("Error communicating with MCP servers. Please ensure the servers are running and try again.",!1)}else R("Failed to connect to MCP servers. Please ensure at least the default server is running at http://localhost:3002",!1)};O.addEventListener("click",(async()=>{const n=P.value.trim();n&&(await U(n),P.value="")})),P.addEventListener("keydown",(n=>{if("Enter"===n.key&&!n.shiftKey){n.preventDefault();const t=P.value.trim();t&&(U(t),P.value="",P.style.height="auto")}}));const D=document.createElement("div");D.classList.add("mcp-input-container"),D.appendChild(P),D.appendChild(O),S.appendChild(D),d.appendChild(p),I.appendChild(S),I.appendChild(d),h.appendChild(v),h.appendChild(m),h.appendChild(I),u.node.appendChild(h);const B=new y.LabIcon({name:"mcp:logo",svgstr:'\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n        <rect x="4" y="4" width="16" height="16" rx="2"/>\n        <path d="M8 8h8M8 12h8M8 16h8"/>\n        <circle cx="4" cy="8" r="1"/>\n        <circle cx="20" cy="8" r="1"/>\n        <circle cx="4" cy="16" r="1"/>\n        <circle cx="20" cy="16" r="1"/>\n      </svg>\n    '}),J=new f.Panel;J.id="mcp-chat",J.title.label="",J.title.icon=B,J.title.closable=!0,J.title.caption="MCP Chat Interface",J.addWidget(u);const F="mcp:open-chat";n.commands.addCommand(F,{label:"Open Chat",caption:"Open Chat Interface",isEnabled:()=>!0,execute:()=>{J.isAttached||n.shell.add(J,"left",{rank:100}),n.shell.activateById(J.id)}}),t.addItem({command:F,category:"MCP"}),n.commands.execute(F)}},A=z},475:(n,t,e)=>{e.d(t,{A:()=>i});var o=e(601),a=e.n(o),r=e(314),s=e.n(r)()(a());s.push([n.id,"/*\n  See the JupyterLab Developer Guide for useful CSS Patterns:\n  https://jupyterlab.readthedocs.io/en/stable/developer/css.html\n*/\n\n.mcp-chat {\n  background: var(--jp-layout-color1);\n  color: var(--jp-ui-font-color1);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.mcp-logo {\n  width: 24px;\n  height: 24px;\n  display: inline-block;\n  vertical-align: middle;\n  margin-right: 4px;\n}\n\n.mcp-toolbar {\n  display: flex;\n  padding: 8px;\n  background: var(--jp-layout-color2);\n  position: relative;\n}\n\n.mcp-tools-button {\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n  margin-left: auto;\n}\n\n.mcp-tools-button:hover {\n  opacity: 1;\n}\n\n.mcp-tools-button svg {\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\n.mcp-plug-icon {\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  margin-left: 8px;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n  transform: rotate(45deg);\n}\n\n.mcp-plug-icon:hover {\n  opacity: 1;\n}\n\n.mcp-plug-icon svg {\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\n.mcp-servers-popup,\n.mcp-tools-popup {\n  position: absolute;\n  top: calc(100% + 8px);\n  right: 8px;\n  background: var(--jp-layout-color0);\n  border: 1px solid var(--jp-border-color1);\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgb(0 0 0 / 15%);\n  min-width: 280px;\n  z-index: 1000;\n  display: none;\n  animation: popup-fade 0.2s ease-out;\n  transform-origin: top right;\n}\n\n.mcp-servers-popup.show,\n.mcp-tools-popup.show {\n  display: block;\n}\n\n.mcp-servers-popup h3,\n.mcp-tools-popup h3 {\n  margin: 0;\n  padding: 12px 16px;\n  font-size: var(--jp-ui-font-size1);\n  font-weight: 600;\n  color: var(--jp-ui-font-color0);\n  border-bottom: 1px solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n  border-top-left-radius: 6px;\n  border-top-right-radius: 6px;\n}\n\n.mcp-servers-header,\n.mcp-tools-header {\n  margin: 0;\n  padding: 12px 16px;\n  font-size: var(--jp-ui-font-size1);\n  font-weight: 600;\n  color: var(--jp-ui-font-color0);\n  background: var(--jp-layout-color2);\n  border-bottom: 1px solid var(--jp-border-color1);\n}\n\n.mcp-servers-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.mcp-servers-header small {\n  font-size: var(--jp-ui-font-size0);\n  font-weight: normal;\n  color: var(--jp-ui-font-color2);\n}\n\n@keyframes popup-fade {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n.mcp-servers-list,\n.mcp-tools-list {\n  list-style: none;\n  margin: 0;\n  padding: 4px;\n}\n\n.mcp-tools-item {\n  padding: 8px 12px;\n  color: var(--jp-ui-font-color1);\n  font-size: var(--jp-ui-font-size1);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border-radius: 4px;\n  margin: 2px 0;\n  transition:\n    background 0.2s,\n    color 0.2s;\n}\n\n.mcp-tools-item:hover {\n  background: var(--jp-layout-color3);\n}\n\n.mcp-tools-server {\n  color: var(--jp-ui-font-color2);\n  font-size: var(--jp-ui-font-size0);\n  background: var(--jp-layout-color2);\n  padding: 2px 6px;\n  border-radius: 3px;\n  margin-left: 8px;\n}\n\n.mcp-server-item {\n  padding: 8px 12px;\n  color: var(--jp-ui-font-color1);\n  font-size: var(--jp-ui-font-size1);\n  border-radius: 4px;\n  margin: 2px 0;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  transition: background 0.2s;\n}\n\n.mcp-server-item:hover {\n  background: var(--jp-layout-color3);\n}\n\n.mcp-no-servers {\n  padding: 12px;\n  color: var(--jp-ui-font-color2);\n  font-style: italic;\n  text-align: center;\n  background: var(--jp-layout-color2);\n  border-radius: 4px;\n  margin: 4px;\n}\n\n.mcp-toolbar-button {\n  background: none;\n  border: none;\n  padding: 4px 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  color: var(--jp-ui-font-color1);\n  margin-right: 8px;\n  border-radius: 4px;\n}\n\n.mcp-toolbar-button:hover {\n  background: var(--jp-layout-color3);\n}\n\n.mcp-toolbar-button svg {\n  width: 16px;\n  height: 16px;\n  margin-right: 4px;\n}\n\n.mcp-chat-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px;\n}\n\n.mcp-chat-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.mcp-chat-item {\n  padding: 12px;\n  border-radius: 8px;\n  background: var(--jp-layout-color2);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.mcp-chat-item:hover {\n  background: var(--jp-layout-color3);\n}\n\n.mcp-chat-title {\n  font-size: var(--jp-ui-font-size1);\n  color: var(--jp-ui-font-color0);\n  margin-bottom: 4px;\n}\n\n.mcp-chat-date {\n  font-size: var(--jp-ui-font-size0);\n  color: var(--jp-ui-font-color2);\n}\n\n.mcp-message {\n  font-size: var(--jp-ui-font-size1);\n  margin-bottom: 16px;\n  padding: 8px 12px;\n  border-radius: 8px;\n  max-width: 85%;\n}\n\n.mcp-message.user {\n  background: var(--jp-layout-color2);\n  margin-left: auto;\n}\n\n.mcp-message.assistant {\n  background: var(--jp-layout-color3);\n  margin-right: auto;\n}\n\n.mcp-input-area {\n  padding: 16px;\n  border-top: 1px solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n}\n\n.mcp-input-container {\n  display: flex;\n  background: var(--jp-layout-color0);\n}\n\n.mcp-input {\n  flex: 1;\n  min-height: 40px;\n  padding: 8px 12px;\n  font-size: var(--jp-ui-font-size1);\n  font-family: var(--jp-ui-font-family);\n  border: none;\n  background: none;\n  resize: none;\n  color: var(--jp-ui-font-color0);\n}\n\n.mcp-input:focus {\n  outline: none;\n}\n\n.mcp-send-button {\n  background: none;\n  border: none;\n  padding: 8px 16px;\n  cursor: pointer;\n  color: var(--jp-brand-color1);\n}\n\n.mcp-send-button:hover {\n  background: var(--jp-layout-color2);\n}\n\n.tool-use {\n  color: var(--jp-brand-color1);\n  font-size: var(--jp-ui-font-size0);\n  padding: 4px 8px;\n  margin: 4px 0;\n  background: var(--jp-layout-color2);\n  border-radius: 4px;\n}\n\n.tool-result {\n  font-size: var(--jp-ui-font-size0);\n  margin: 4px 0;\n  border: 1px solid var(--jp-border-color1);\n  border-radius: 4px;\n}\n\n.tool-result.error {\n  border-color: var(--jp-error-color1);\n}\n\n.tool-result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 4px 8px;\n  background: var(--jp-layout-color2);\n  border-bottom: 1px solid var(--jp-border-color1);\n}\n\n.tool-result-toggle {\n  background: none;\n  border: none;\n  padding: 2px 6px;\n  font-size: var(--jp-ui-font-size0);\n  cursor: pointer;\n  color: var(--jp-brand-color1);\n}\n\n.tool-result-toggle:hover {\n  background: var(--jp-layout-color3);\n  border-radius: 4px;\n}\n\n.tool-result > div:not(.tool-result-header) {\n  display: none;\n  padding: 8px;\n  background: var(--jp-layout-color0);\n  white-space: pre-wrap;\n}\n\n.tool-result.expanded > div:not(.tool-result-header) {\n  display: block;\n}\n",""]);const i=s},646:(n,t,e)=>{e.d(t,{A:()=>l});var o=e(601),a=e.n(o),r=e(314),s=e.n(r),i=e(475),c=s()(a());c.i(i.A),c.push([n.id,".mcp-chat {\n  position: fixed;\n  inset: 0;\n  display: flex;\n  flex-direction: column;\n  background: #faf9f7;\n}\n\n.mcp-chat-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px;\n  padding-bottom: 100px;\n  background: #faf9f7;\n  scrollbar-width: thin;\n  scrollbar-color: #e6e2dd transparent;\n}\n\n.mcp-chat-area::-webkit-scrollbar {\n  width: 8px;\n}\n\n.mcp-chat-area::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.mcp-chat-area::-webkit-scrollbar-thumb {\n  background-color: #e6e2dd;\n  border-radius: 4px;\n}\n\n.mcp-message {\n  margin: 8px 0;\n  padding: 8px 12px;\n  border-radius: 12px;\n  max-width: 80%;\n  font-size: 14px;\n  line-height: 1.5;\n  word-break: break-word;\n  overflow-wrap: break-word;\n}\n\n.mcp-message-markdown {\n  margin: 0;\n  padding: 0;\n}\n\n.mcp-message.user {\n  background: #f0ece6;\n  margin-left: auto;\n  color: #444;\n}\n\n.mcp-message.assistant {\n  background: #fff;\n  margin-right: auto;\n  color: #444;\n  border: 1px solid #e6e2dd;\n}\n\n.mcp-input-area {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 2px;\n  background: #fff;\n  border-top: 1px solid #e6e2dd;\n  box-sizing: border-box;\n  box-shadow: 0 -2px 10px rgb(0 0 0 / 5%);\n  max-height: 100px;\n  z-index: 1000;\n}\n\n.mcp-input-wrapper {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  width: 100%;\n}\n\n.mcp-input-container {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 12px;\n  background: #fff;\n}\n\n.mcp-input {\n  flex: 1;\n  padding: 0;\n  border: none;\n  background: transparent;\n  color: #444;\n  resize: none;\n  min-height: 24px;\n  max-height: 48px;\n  overflow-y: auto;\n  line-height: 1.4;\n  box-sizing: border-box;\n}\n\n.mcp-input:focus {\n  outline: none;\n}\n\n.mcp-send-button {\n  width: 32px;\n  height: 32px;\n  background: #f0ece6;\n  color: #444;\n  border: none;\n  border-radius: 50%;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n  margin-right: -4px;\n}\n\n.mcp-send-button::before {\n  content: '↑';\n  font-size: 18px;\n}\n\n.mcp-send-button:hover {\n  background: #e6e2dd;\n}\n\n.mcp-send-button:active {\n  background: #dcd8d3;\n}\n\n.tool-result {\n  position: relative;\n  max-height: 150px;\n  overflow-y: auto;\n  padding: 8px;\n  background: #f8f8f8;\n  border-radius: 6px;\n  margin: 8px 0;\n  font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, Courier,\n    monospace;\n  font-size: 13px;\n  transition: max-height 0.3s ease;\n}\n\n.tool-result pre {\n  margin: 8px 0 0;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n.tool-result.expanded {\n  max-height: none;\n}\n\n.tool-result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 4px;\n  color: #666;\n  font-size: 0.9em;\n}\n\n.tool-result-toggle {\n  background: none;\n  border: none;\n  color: #666;\n  cursor: pointer;\n  padding: 2px 6px;\n  font-size: 0.9em;\n  border-radius: 4px;\n}\n\n.tool-result-toggle:hover {\n  background: #eee;\n}\n\n.tool-result.error {\n  background: #fff0f0;\n  border: 1px solid #ffcdd2;\n}\n\n.mcp-model-select {\n  position: relative;\n  display: inline-block;\n  background: #f7f7f7;\n  border-radius: 8px;\n  padding: 2px 4px;\n  margin-bottom: 8px;\n  width: fit-content;\n  z-index: 1001;\n}\n\n.mcp-model-select select {\n  appearance: none;\n  -webkit-appearance: none;\n  width: auto;\n  padding: 6px 28px 6px 8px;\n  border: none;\n  background: transparent;\n  color: #333;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  outline: none;\n}\n\n.mcp-model-select::after {\n  content: '▼';\n  font-size: 8px;\n  color: #666;\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n  pointer-events: none;\n}\n\n.mcp-model-select select:focus {\n  outline: none;\n}\n\n.mcp-model-select select option {\n  padding: 10px;\n  font-size: 14px;\n  background: #fff;\n  color: #333;\n  font-weight: 500;\n}\n\n.mcp-model-select select option:hover,\n.mcp-model-select select option:focus {\n  background: #f7f7f7;\n}\n\n.mcp-token-usage-popup {\n  position: absolute;\n  top: calc(100% + 8px);\n  left: 8px;\n  background: var(--jp-layout-color0, #fff);\n  border: 1px solid var(--jp-border-color1, #e6e2dd);\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgb(0 0 0 / 15%);\n  min-width: 280px;\n  z-index: 1000;\n  display: none;\n  animation: popup-fade 0.2s ease-out;\n  transform-origin: top left;\n  padding: 0;\n}\n\n.mcp-token-usage-popup.show {\n  display: block;\n}\n\n.mcp-token-usage-header {\n  margin: 0;\n  padding: 12px 16px;\n  font-size: var(--jp-ui-font-size1, 14px);\n  font-weight: 600;\n  color: var(--jp-ui-font-color0, #333);\n  background: var(--jp-layout-color2, #f5f5f5);\n  border-bottom: 1px solid var(--jp-border-color1, #e6e2dd);\n}\n\n.mcp-token-usage-content {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  padding: 12px;\n}\n\n.mcp-token-usage-item {\n  padding: 6px 10px;\n  background: var(--jp-layout-color2, #f5f5f5);\n  border-radius: 4px;\n  font-family: var(--jp-code-font-family, monospace);\n  font-size: var(--jp-ui-font-size0, 12px);\n  color: var(--jp-ui-font-color1, #444);\n}\n\n.mcp-token-usage-button {\n  position: relative;\n}\n",""]);const l=c}}]);